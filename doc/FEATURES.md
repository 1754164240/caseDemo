# 功能说明文档

## 需求管理功能

### 1. 上传需求文档

**功能描述**:
- 支持上传多种格式的需求文档（DOCX、PDF、TXT、XLS、XLSX）
- 自动解析文档内容
- 使用 AI 识别测试点

**使用步骤**:
1. 点击"上传需求"按钮
2. 填写需求标题（必填）
3. 填写需求描述（可选）
4. 选择需求文档文件
5. 点击"上传"

**处理流程**:
1. 文件上传到服务器
2. 后台解析文档内容
3. 调用 AI 服务提取测试点
4. 通过 WebSocket 实时通知处理进度
5. 状态更新为"已完成"

**状态说明**:
- 🔵 **已上传**: 文档已上传，等待处理
- 🟠 **处理中**: 正在解析文档和生成测试点
- 🟢 **已完成**: 测试点生成完成
- 🔴 **失败**: 处理过程中出现错误

---

### 2. 查看需求详情

**功能描述**:
- 查看需求的完整信息
- 查看该需求下的所有测试点
- 下载需求文档

**使用步骤**:
1. 在需求列表中找到目标需求
2. 点击"查看"按钮
3. 右侧抽屉打开显示详情

**显示内容**:
- **需求信息**:
  - 需求标题
  - 需求描述
  - **文件名**（可点击下载 📥）
  - 文件类型
  - 文件大小
  - 处理状态
  - 创建时间

- **测试点列表**:
  - ID
  - 标题
  - 描述
  - 分类（功能/边界/异常/业务规则）
  - 优先级（高/中/低）

**下载功能**:
- 📥 点击文件名旁的下载图标
- 自动下载原始需求文档
- 保持原文件名和格式
- 支持所有上传的文件类型（TXT、DOCX、PDF、XLS、XLSX）

---

### 3. 生成测试点

**功能描述**:
- 重新生成需求的测试点
- 删除旧的测试点，使用 AI 重新分析

**使用场景**:
1. **首次上传时未配置 API Key**: 上传时使用了模拟数据，配置 API Key 后重新生成
2. **需求文档已更新**: 需求发生变化，需要重新分析
3. **对现有测试点不满意**: 希望 AI 重新生成测试点

**使用步骤**:
1. 在需求列表中找到目标需求
2. 点击"生成测试点"按钮
3. 确认提示框（会删除现有测试点）
4. 等待后台处理完成

**注意事项**:
- ⚠️ 会删除该需求下的所有旧测试点
- ⚠️ 会删除关联的所有测试用例
- ⚠️ 操作不可恢复
- ✅ 确保已配置 OpenAI API Key
- ✅ 生成过程在后台进行，不影响其他操作

---

### 4. 删除需求

**功能描述**:
- 删除需求及其所有关联数据

**删除内容**:
- 需求记录
- 上传的文档文件
- 所有测试点
- 所有测试用例

**使用步骤**:
1. 在需求列表中找到目标需求
2. 点击"删除"按钮
3. 确认删除操作

**注意事项**:
- ⚠️ 操作不可恢复
- ⚠️ 会删除所有关联数据

---

## 测试点管理功能

### 1. 查看测试点列表

**功能描述**:
- 查看所有测试点
- 按需求筛选测试点
- 显示所属需求信息
- 优化的列宽和横向滚动

**使用步骤**:
1. 进入"用例管理"页面
2. 在"测试点"标签页查看
3. 使用下拉框筛选特定需求的测试点

**显示内容**:
- ID（60px，固定左侧）
- 标题（180px，支持省略）
- **所属需求**（150px，绿色标签，支持省略）
- 描述（250px，支持省略）
- 分类（100px，蓝色标签）
- **优先级**（80px，中文显示：高/中/低）
  - 高 - 红色标签
  - 中 - 橙色标签
  - 低 - 绿色标签
- 用例数量（80px，居中）
- 创建时间（150px）

**界面优化**:
- ✅ **动态列宽**: 优化各列宽度，确保重要信息可见
- ✅ **横向滚动**: 支持横向滚动查看所有列（总宽 1400px）
- ✅ **固定列**: ID 列固定在左侧，滚动时不移动
- ✅ **文本省略**: 长文本自动省略，鼠标悬停显示完整内容
- ✅ **中文优先级**: 优先级显示为中文（高/中/低）

**筛选功能**:
- 📋 **按需求筛选**: 选择特定需求，只显示该需求下的测试点
- 📊 **统计信息**: 显示当前测试点总数
- 📄 **分页显示**: 每页显示 10 条，支持切换每页数量

**操作列功能**:
- 👁️ **查看**: 查看测试点详情和生成的用例
- ⚡ **生成用例**: 为测试点生成测试用例
- 🗑️ **删除**: 删除测试点及其关联用例

---

### 2. 查看测试点详情

**功能描述**:
- 查看测试点的完整信息
- 查看该测试点生成的所有测试用例

**使用步骤**:
1. 在测试点列表中找到目标测试点
2. 点击"查看"按钮
3. 右侧抽屉打开显示详情

**显示内容**:

**测试点信息**:
- ID
- 标题
- 描述
- 分类（功能/边界/异常/业务规则）
- 优先级（高/中/低）
- 用例数量
- 创建时间
- 用户反馈（如果有）

**生成的测试用例列表**:
- ID
- 标题
- 描述
- 优先级
- 操作（查看详情）

**功能特性**:
- 📊 一目了然查看测试点的所有信息
- 📝 直接查看该测试点下的所有用例
- 🔗 可以快速跳转到用例详情
- 📄 支持分页显示用例（每页10条）

---

### 3. 生成测试用例

**功能描述**:
- 为测试点生成详细的测试用例

**使用步骤**:
1. 在测试点列表中找到目标测试点
2. 点击"生成用例"按钮
3. 等待 AI 生成测试用例
4. 通过 WebSocket 接收生成完成通知

**生成内容**:
- 测试用例标题
- 测试用例描述
- 前置条件
- 测试步骤
- 预期结果
- 优先级
- 测试类型

**注意事项**:
- ✅ 生成过程在后台进行
- ✅ 可以为同一个测试点多次生成用例
- ✅ 新生成的用例会追加到现有用例列表

---

### 4. 提交反馈

**功能描述**:
- 对测试点提交反馈意见
- 根据反馈重新生成测试点

**使用场景**:
- 测试点不够详细
- 测试点遗漏了某些场景
- 需要调整测试点的重点

**使用步骤**:
1. 查看测试点详情
2. 填写反馈意见
3. 提交反馈
4. 系统根据反馈重新生成测试点

---

### 5. 删除测试点

**功能描述**:
- 删除单个测试点及其关联的测试用例

**使用步骤**:
1. 在测试点列表中找到目标测试点
2. 点击"删除"按钮
3. 确认删除操作

**注意事项**:
- ⚠️ 会删除该测试点下的所有测试用例
- ⚠️ 操作不可恢复

---

## 测试用例管理功能

### 1. 查看测试用例列表

**功能描述**:
- 查看所有生成的测试用例
- 支持按测试点筛选
- 支持关键词搜索

**使用步骤**:
1. 进入"用例管理"页面
2. 切换到"测试用例"标签页
3. 查看所有测试用例

**显示内容**:
- ID
- 标题
- 所属测试点
- 描述
- 优先级
- 测试类型
- 创建时间

**筛选和搜索功能**:

1. **按测试点筛选**:
   - 使用"筛选测试点"下拉框
   - 选择特定测试点
   - 只显示该测试点下的用例

2. **关键词搜索**:
   - 在搜索框输入关键词
   - 支持搜索范围：
     - 标题
     - 描述
     - 前置条件
     - 预期结果
   - 实时过滤结果

3. **组合筛选**:
   - 可以同时使用测试点筛选和关键词搜索
   - 点击"清除筛选"恢复显示所有用例

4. **统计信息**:
   - 显示当前筛选结果数量
   - 显示总用例数量

**操作列功能**:
- 👁️ **查看**: 查看测试用例详情
- ✏️ **编辑**: 编辑测试用例内容
- 🗑️ **删除**: 删除测试用例

---

### 2. 查看测试用例详情

**功能描述**:
- 查看测试用例的完整信息

**使用步骤**:
1. 在测试用例列表中找到目标用例
2. 点击"查看"按钮
3. 右侧抽屉打开显示详情

**显示内容**:
- ID
- 标题
- 描述
- 优先级（高/中/低）
- 测试类型
- 前置条件（完整内容）
- 测试步骤（完整内容）
- 预期结果（完整内容）
- 创建时间

**功能特性**:
- 📋 完整显示所有字段内容
- 📝 支持多行文本显示
- 🎨 优先级和类型使用标签高亮显示

---

### 3. 编辑测试用例

**功能描述**:
- 修改测试用例的内容
- 支持编辑所有字段
- 自动处理对象数组格式

**可编辑字段**:
- ✏️ **标题**（必填）
- 📝 **描述**
- 🔧 **前置条件**
- 📋 **测试步骤**（多行文本）
- ✅ **预期结果**
- 🎯 **优先级**（高/中/低）
- 🏷️ **测试类型**

**使用步骤**:
1. 在测试用例列表中找到目标用例
2. 点击"编辑"按钮
3. 在弹出的对话框中修改字段
4. 点击"保存"按钮

**功能特性**:
- ✅ **智能格式转换**: 对象数组自动转换为可编辑文本
- ✅ **表单验证**: 标题为必填项
- ✅ **多行输入**: 测试步骤支持多行输入
- ✅ **中文优先级**: 下拉选择高/中/低
- ✅ **实时更新**: 保存后立即刷新列表

**测试步骤格式**:
```
1. 打开登录页面
2. 输入用户名和密码
3. 点击登录按钮
4. 验证跳转到首页
```

**注意事项**:
- 📌 测试步骤每行一个步骤
- 📌 修改后会覆盖原有内容
- 📌 保存前请仔细检查

---

### 4. 删除测试用例

**功能描述**:
- 删除单个测试用例

**使用步骤**:
1. 在测试用例列表中找到目标用例
2. 点击"删除"按钮
3. 确认删除操作

---

## 系统配置管理

### 1. 通过界面配置（推荐）

**功能描述**:
- 通过 Web 界面配置系统参数
- 配置自动保存到数据库和 .env 文件
- 只有超级管理员可以访问

**使用步骤**:
1. 使用管理员账号登录
2. 进入"系统管理"页面
3. 配置 Milvus 或模型参数
4. 点击"保存配置"

#### Milvus 配置

**配置项**:
- **Milvus Host**: Milvus 服务器地址（默认: localhost）
- **Milvus Port**: Milvus 服务器端口（默认: 19530）

**注意事项**:
- ✅ 配置会同时保存到数据库和 .env 文件
- ⚠️ 需要重启后端才能完全生效

#### 模型配置

**配置项**:
- **API Key**: API 密钥
- **API Base URL**: API 基础地址
- **模型名称**: 使用的模型

**功能特性**:
- 🔒 API Key 显示时自动脱敏
- 💾 配置同时保存到数据库和 .env 文件
- 🔄 部分配置立即生效，完全生效需要重启后端

**安全提示**:
- ⚠️ 只有超级管理员可以访问配置管理
- 🔐 请确保数据库安全
- 📋 建议定期更换 API Key

---

### 2. 通过配置文件配置

**配置文件**: `backend/.env`

**必需配置**:
```env
OPENAI_API_KEY=your-api-key-here
OPENAI_API_BASE=https://api.openai.com/v1
MODEL_NAME=gpt-4
```

**支持的 API**:
- OpenAI 官方 API
- Azure OpenAI
- 兼容 OpenAI 格式的第三方 API（如 ModelScope）

**配置示例**:

1. **OpenAI 官方**:
```env
OPENAI_API_KEY=sk-...
OPENAI_API_BASE=https://api.openai.com/v1
MODEL_NAME=gpt-4
```

2. **ModelScope**:
```env
OPENAI_API_KEY=ms-...
OPENAI_API_BASE=https://api-inference.modelscope.cn/v1/chat/completions
MODEL_NAME=deepseek-ai/DeepSeek-V3.1
```

---

## WebSocket 实时通知

**功能描述**:
- 实时推送测试点生成进度
- 实时推送测试用例生成进度

**通知类型**:
1. **测试点生成完成**: 显示生成的测试点数量
2. **测试用例生成完成**: 显示生成的测试用例数量

**自动刷新**:
- 收到通知后自动刷新相关列表
- 无需手动刷新页面

---

## 常见问题

### 1. 上传文档后一直显示"处理中"

**可能原因**:
- OpenAI API Key 未配置
- API Key 无效或额度不足
- 网络连接问题

**解决方法**:
1. 检查 `.env` 文件中的 API Key 配置
2. 运行 `test-document-processing.bat` 测试
3. 查看后端日志了解详细错误

### 2. 测试点内容是示例数据

**原因**: OpenAI API Key 未配置或调用失败

**解决方法**:
1. 配置正确的 API Key
2. 点击"生成测试点"重新生成

### 3. 生成的测试点不符合预期

**解决方法**:
1. 点击"生成测试点"重新生成
2. 或在测试点详情中提交反馈意见

---

## 技术支持

如遇到问题，请查看：
- `TROUBLESHOOTING.md` - 故障排除指南
- `README_SETUP.md` - 安装配置指南
- 后端日志 - 查看详细错误信息

