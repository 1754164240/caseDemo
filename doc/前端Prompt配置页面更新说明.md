# 前端 Prompt 配置页面更新说明

## 更新概述

前端的 Prompt 配置页面已更新,现在支持配置三套业务线专用的测试用例生成 Prompt。

## 更新内容

### 1. API 接口更新

**文件**: `frontend/src/services/api.ts`

更新了 `updatePromptConfig` 接口,现在接受以下参数:

```typescript
{
  test_point_prompt: string;              // 测试点生成 Prompt
  test_case_prompt: string;               // 默认测试用例 Prompt
  contract_test_case_prompt: string;      // 契约业务线测试用例 Prompt
  preservation_test_case_prompt: string;  // 保全业务线测试用例 Prompt
  claim_test_case_prompt: string;         // 理赔业务线测试用例 Prompt
}
```

### 2. 配置页面更新

**文件**: `frontend/src/pages/Settings.tsx`

#### 新增的配置项:

1. **测试点生成 Prompt**
   - 用于从需求文档中提取测试点
   - 会自动识别业务线
   - 支持 `{feedback_instruction}` 占位符

2. **默认测试用例生成 Prompt**
   - 用于生成通用测试用例
   - 当业务线未识别时使用

3. **契约业务线测试用例 Prompt** (新增)
   - 专门用于契约业务的测试用例生成
   - 关注投保、核保、保单生成等流程

4. **保全业务线测试用例 Prompt** (新增)
   - 专门用于保全业务的测试用例生成
   - 关注保单变更、批改、续保等流程

5. **理赔业务线测试用例 Prompt** (新增)
   - 专门用于理赔业务的测试用例生成
   - 关注理赔申请、审核、支付等流程

## 页面效果

### 配置表单布局

```
┌─────────────────────────────────────────────────────┐
│ 测试点生成 Prompt                                    │
│ ┌─────────────────────────────────────────────────┐ │
│ │ (10 行文本框)                                    │ │
│ └─────────────────────────────────────────────────┘ │
│ 用于从需求文档中提取测试点的 AI Prompt...            │
├─────────────────────────────────────────────────────┤
│ 默认测试用例生成 Prompt                              │
│ ┌─────────────────────────────────────────────────┐ │
│ │ (8 行文本框)                                     │ │
│ └─────────────────────────────────────────────────┘ │
│ 用于生成通用测试用例的 AI Prompt...                  │
├─────────────────────────────────────────────────────┤
│ 契约业务线测试用例 Prompt                            │
│ ┌─────────────────────────────────────────────────┐ │
│ │ (8 行文本框)                                     │ │
│ └─────────────────────────────────────────────────┘ │
│ 专门用于契约业务的测试用例生成...                    │
├─────────────────────────────────────────────────────┤
│ 保全业务线测试用例 Prompt                            │
│ ┌─────────────────────────────────────────────────┐ │
│ │ (8 行文本框)                                     │ │
│ └─────────────────────────────────────────────────┘ │
│ 专门用于保全业务的测试用例生成...                    │
├─────────────────────────────────────────────────────┤
│ 理赔业务线测试用例 Prompt                            │
│ ┌─────────────────────────────────────────────────┐ │
│ │ (8 行文本框)                                     │ │
│ └─────────────────────────────────────────────────┘ │
│ 专门用于理赔业务的测试用例生成...                    │
├─────────────────────────────────────────────────────┤
│ [保存配置]                                          │
└─────────────────────────────────────────────────────┘
```

## 使用说明

### 1. 访问配置页面

1. 登录系统(需要超级管理员权限)
2. 点击左侧菜单 "系统配置"
3. 切换到 "Prompt 配置" 标签页

### 2. 编辑 Prompt

1. 在对应的文本框中编辑 Prompt 内容
2. 所有字段都是必填项
3. 使用等宽字体显示,方便编辑

### 3. 保存配置

1. 点击 "保存配置" 按钮
2. 等待保存成功提示
3. 配置立即生效,无需重启服务

## 默认 Prompt 内容

### 契约业务线测试用例 Prompt

```
你是一个专业的保险契约业务测试专家。请根据测试点生成详细的契约业务测试用例。

契约业务特点：
- 关注投保流程、保单生成、保费计算
- 重点验证保险条款、责任范围、除外责任
- 注意核保规则、风险评估、保单承保

测试用例应该包含：
- title: 用例标题
- description: 用例描述
- preconditions: 前置条件（如：客户信息、产品配置）
- test_steps: 测试步骤（数组格式，每步包含 step, action, expected）
- expected_result: 预期结果
- priority: 优先级
- test_type: 测试类型

请以JSON格式返回测试用例列表。
```

### 保全业务线测试用例 Prompt

```
你是一个专业的保险保全业务测试专家。请根据测试点生成详细的保全业务测试用例。

保全业务特点：
- 关注保单变更、批改、续保流程
- 重点验证保单信息修改、受益人变更、保额调整
- 注意保全规则、生效时间、费用计算

测试用例应该包含：
- title: 用例标题
- description: 用例描述
- preconditions: 前置条件（如：有效保单、变更申请）
- test_steps: 测试步骤（数组格式，每步包含 step, action, expected）
- expected_result: 预期结果
- priority: 优先级
- test_type: 测试类型

请以JSON格式返回测试用例列表。
```

### 理赔业务线测试用例 Prompt

```
你是一个专业的保险理赔业务测试专家。请根据测试点生成详细的理赔业务测试用例。

理赔业务特点：
- 关注理赔申请、审核、支付流程
- 重点验证理赔条件、责任认定、赔付金额计算
- 注意理赔时效、材料审核、反欺诈检查

测试用例应该包含：
- title: 用例标题
- description: 用例描述
- preconditions: 前置条件（如：出险事故、理赔材料）
- test_steps: 测试步骤（数组格式，每步包含 step, action, expected）
- expected_result: 预期结果
- priority: 优先级
- test_type: 测试类型

请以JSON格式返回测试用例列表。
```

## 工作流程

### 完整的业务线识别和测试用例生成流程:

```
1. 用户上传需求文档
   ↓
2. AI 使用 "测试点生成 Prompt" 提取测试点
   ↓
3. AI 自动识别每个测试点的业务线
   - contract (契约)
   - preservation (保全)
   - claim (理赔)
   ↓
4. 保存测试点及业务线信息到数据库
   ↓
5. 用户点击生成测试用例
   ↓
6. 系统根据测试点的业务线选择对应的 Prompt:
   - 契约 → 使用 "契约业务线测试用例 Prompt"
   - 保全 → 使用 "保全业务线测试用例 Prompt"
   - 理赔 → 使用 "理赔业务线测试用例 Prompt"
   - 未识别 → 使用 "默认测试用例生成 Prompt"
   ↓
7. AI 使用对应的 Prompt 生成专业的测试用例
   ↓
8. 保存测试用例到数据库
```

## 注意事项

1. **权限要求**: 只有超级管理员可以访问和修改 Prompt 配置
2. **必填字段**: 所有 Prompt 字段都是必填的
3. **立即生效**: 保存后立即生效,无需重启服务
4. **格式要求**: Prompt 应该清晰地说明 AI 需要生成的内容格式
5. **业务专业性**: 建议根据实际业务需求调整各业务线的 Prompt

## 测试建议

1. **测试默认 Prompt**: 上传一个通用需求文档,验证默认 Prompt 是否正常工作
2. **测试契约业务**: 上传契约相关需求,验证是否使用契约 Prompt
3. **测试保全业务**: 上传保全相关需求,验证是否使用保全 Prompt
4. **测试理赔业务**: 上传理赔相关需求,验证是否使用理赔 Prompt
5. **测试配置保存**: 修改 Prompt 后保存,验证是否成功保存并生效

## 相关文件

- **前端 API**: `frontend/src/services/api.ts`
- **前端页面**: `frontend/src/pages/Settings.tsx`
- **后端 API**: `backend/app/api/v1/endpoints/system_config.py`
- **后端 Schema**: `backend/app/schemas/system_config.py`
- **AI 服务**: `backend/app/services/ai_service.py`

