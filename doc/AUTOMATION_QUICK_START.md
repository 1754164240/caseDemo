# 自动化用例生成 - 快速开始

## 🚀 功能说明

一键将测试用例转换为自动化测试平台的自动化用例，自动匹配场景并创建。

## 📋 前置条件

### 1. 配置自动化平台（推荐使用系统配置）⭐

**方式一：通过系统配置（推荐）**

1. 使用管理员账号登录系统
2. 进入"系统配置"页面
3. 找到"自动化测试平台配置"
4. 填写以下信息：
   - **API地址**：`http://your-automation-platform.com`
   - **模块ID**：`a7f94755-b7c6-42ba-ba12-9026d9760cf5`
5. 点击"保存"

**优势**：
- ✅ 配置一次，全员共享
- ✅ 无需每次输入模块ID
- ✅ 集中管理，便于维护

**方式二：通过环境变量（传统方式）**

编辑 `backend/.env` 文件，添加：

```bash
AUTOMATION_PLATFORM_API_BASE=http://your-automation-platform.com
AUTOMATION_PLATFORM_MODULE_ID=a7f94755-b7c6-42ba-ba12-9026d9760cf5
```

**重启后端服务**以使配置生效。

### 2. 创建场景

在"场景管理"页面创建至少一个场景：

- **场景编号**：如 `SC001`
- **场景名称**：如 `保单创建场景`
- **业务线**：如 `contract`（契约）、`claim`（理赔）等
- **模块**：如 `policy_creation`
- **状态**：确保为"启用"

## 📝 使用步骤

### 步骤 1：进入测试用例页面

导航到"测试用例"页面，找到要生成自动化用例的测试用例。

### 步骤 2：点击自动化按钮

在测试用例表格的操作列，点击 **"自动化"** 按钮（🤖 图标）。

### 步骤 3：确认或修改模块ID

在弹出的对话框中：

**情况A：已在系统配置中设置模块ID**
- ✅ 对话框会自动填充系统配置的模块ID
- ✅ 直接点击"生成"按钮即可
- ⚙️ 如需使用其他模块ID，可手动修改

**情况B：未在系统配置中设置模块ID**
- 📝 手动输入自动化平台的**模块ID**
- 点击"生成"按钮

### 步骤 4：查看结果

生成成功后，系统会显示：
- ✅ 匹配的场景信息
- ✅ 创建的自动化用例ID
- ✅ 自动化平台返回的详细信息
- ✅ 支持的字段列表

## 🔍 场景匹配规则

系统会自动匹配最合适的场景：

1. **优先级1**：业务线 + 模块都匹配
2. **优先级2**：只匹配业务线
3. **优先级3**：任意启用的场景

**示例：**

| 测试点信息 | 场景1 | 场景2 | 场景3 | 匹配结果 |
|-----------|-------|-------|-------|---------|
| 业务线：contract<br>模块：policy | ✅ contract<br>✅ policy | ✅ contract<br>❌ claim | ❌ preservation<br>❌ - | 场景1 |
| 业务线：contract<br>模块：未设置 | ✅ contract<br>policy | ✅ contract<br>claim | ❌ preservation<br>- | 场景1 |

## ⚠️ 常见问题

### Q1: 提示"自动化测试平台服务未配置或不可用"

**原因**：未配置 `AUTOMATION_PLATFORM_API_BASE` 环境变量

**解决**：
1. 编辑 `backend/.env`，添加配置
2. 重启后端服务

### Q2: 提示"未找到可用的场景"

**原因**：场景管理中没有启用的场景

**解决**：
1. 进入"场景管理"页面
2. 创建新场景或启用现有场景

### Q3: 提示"请输入模块ID"

**原因**：未输入或输入的模块ID为空

**解决**：
1. 确保输入了完整的模块ID
2. 检查ID格式是否正确（通常是UUID格式）

### Q4: 创建失败，提示"调用自动化平台失败"

**可能原因**：
- 自动化平台地址配置错误
- 网络连接问题
- 自动化平台服务不可用
- 参数格式不正确

**解决**：
1. 检查 `AUTOMATION_PLATFORM_API_BASE` 配置
2. 测试网络连接：`ping your-automation-platform.com`
3. 检查自动化平台服务是否正常运行
4. 查看后端日志获取详细错误信息

## 📊 API 接口说明

### 生成自动化用例

```http
POST /api/v1/test-cases/{test_case_id}/generate-automation?module_id={module_id}
Authorization: Bearer {token}
```

**路径参数：**
- `test_case_id`: 测试用例ID

**查询参数：**
- `module_id`: 自动化平台的模块ID（必填）

**成功响应（200）：**
```json
{
  "success": true,
  "message": "自动化用例创建成功",
  "data": {
    "test_case": {
      "id": 123,
      "code": "TC001",
      "title": "测试用例标题"
    },
    "matched_scenario": {
      "scenario_code": "SC001",
      "name": "场景名称"
    },
    "automation_case": {
      "usercaseId": "8dba1192-7f86-420a-b69e-8e00d06db36a",
      "num": 18880
    },
    "usercase_id": "8dba1192-7f86-420a-b69e-8e00d06db36a"
  }
}
```

**错误响应：**
- `503`: 服务未配置
- `404`: 测试用例或场景不存在
- `500`: 创建失败

## 🔧 配置检查清单

部署前请确认：

- [ ] 已配置 `AUTOMATION_PLATFORM_API_BASE`
- [ ] 已重启后端服务
- [ ] 场景管理中至少有一个启用的场景
- [ ] 已获取自动化平台的模块ID
- [ ] 网络可以访问自动化平台

## 📞 技术支持

如遇到问题，请：

1. 查看后端日志：`backend.log`
2. 检查浏览器控制台错误信息
3. 参考详细文档：[AUTOMATION_PLATFORM_INTEGRATION.md](./AUTOMATION_PLATFORM_INTEGRATION.md)

## 🎯 下一步

- [ ] 了解[场景管理功能](./SCENARIO_COMPLETE_GUIDE.md)
- [ ] 配置多个场景以提高匹配准确率
- [ ] 为测试点设置正确的业务线和模块信息
- [ ] 定期同步自动化平台的执行结果

---

**更新时间**：2024-12-16  
**版本**：1.0

