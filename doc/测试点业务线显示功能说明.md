# 测试点业务线显示功能说明

## 功能概述

在测试点列表和详情页面中显示测试点所属的业务线,帮助用户快速识别测试点的业务类型。

## 更新内容

### 1. 测试点列表页面 (`frontend/src/pages/TestCases.tsx`)

#### 新增业务线列

在测试点列表表格中添加了"业务线"列:

- **位置**: 分类列和优先级列之间
- **宽度**: 90px
- **对齐**: 居中
- **显示方式**: 彩色标签

#### 业务线标签样式

| 业务线 | 显示文本 | 标签颜色 |
|--------|----------|----------|
| contract | 契约 | 蓝色 (blue) |
| preservation | 保全 | 绿色 (green) |
| claim | 理赔 | 橙色 (orange) |
| 未识别 | 未识别 | 灰色 (default) |

#### 表格宽度调整

- 原宽度: 1400px
- 新宽度: 1500px (增加 100px 以容纳业务线列)

### 2. 测试点详情抽屉

在测试点详情的描述列表中添加了"业务线"字段:

- **位置**: 分类字段和优先级字段之间
- **显示方式**: 彩色标签
- **样式**: 与列表中的业务线标签保持一致

### 3. 需求详情页面 (`frontend/src/pages/Requirements.tsx`)

在需求详情抽屉中的测试点列表也添加了"业务线"列:

- **位置**: 分类列和优先级列之间
- **宽度**: 90px
- **对齐**: 居中
- **显示方式**: 彩色标签

## 页面效果

### 测试点列表表格

```
┌────┬──────┬──────┬──────┬────┬────┬────┬────┬────┬────┐
│ ID │ 标题 │ 需求 │ 描述 │分类│业务│优先│用例│审批│操作│
│    │      │      │      │    │线  │级  │数  │状态│    │
├────┼──────┼──────┼──────┼────┼────┼────┼────┼────┼────┤
│ 1  │ ... │ ... │ ... │功能│契约│高  │ 3  │通过│... │
│    │      │      │      │    │🔵  │🔴  │    │    │    │
├────┼──────┼──────┼──────┼────┼────┼────┼────┼────┼────┤
│ 2  │ ... │ ... │ ... │边界│保全│中  │ 2  │待审│... │
│    │      │      │      │    │🟢  │🟠  │    │    │    │
├────┼──────┼──────┼──────┼────┼────┼────┼────┼────┼────┤
│ 3  │ ... │ ... │ ... │异常│理赔│低  │ 1  │待审│... │
│    │      │      │      │    │🟠  │🟢  │    │    │    │
└────┴──────┴──────┴──────┴────┴────┴────┴────┴────┴────┘
```

### 测试点详情抽屉

```
┌─────────────────────────────────────────────┐
│ 测试点详情                                   │
├─────────────────────────────────────────────┤
│ 测试点编号: TP-001                           │
├─────────────────────────────────────────────┤
│ 标题: 投保人信息验证                         │
├─────────────────────────────────────────────┤
│ 描述: 验证投保人基本信息的完整性和准确性      │
├─────────────────────────────────────────────┤
│ 分类: [功能]                                 │
├─────────────────────────────────────────────┤
│ 业务线: [契约] 🔵                            │
├─────────────────────────────────────────────┤
│ 优先级: [高] 🔴                              │
├─────────────────────────────────────────────┤
│ 用例数量: 3                                  │
├─────────────────────────────────────────────┤
│ 审批状态: [已通过] 🟢                        │
├─────────────────────────────────────────────┤
│ 创建时间: 2025-01-10 10:30:00               │
└─────────────────────────────────────────────┘
```

## 业务线识别逻辑

### 自动识别

当用户上传需求文档时,AI 会自动识别测试点所属的业务线:

1. **契约业务** (contract):
   - 关键词: 投保、核保、保单生成、保费计算、承保
   - 示例: "投保人信息验证"、"保费计算规则"

2. **保全业务** (preservation):
   - 关键词: 保单变更、批改、续保、受益人变更、保额调整
   - 示例: "受益人变更流程"、"保单信息修改"

3. **理赔业务** (claim):
   - 关键词: 理赔申请、理赔审核、赔付、出险、理赔材料
   - 示例: "理赔申请提交"、"赔付金额计算"

### 未识别情况

如果 AI 无法识别测试点的业务线,将显示"未识别"标签(灰色)。

## 使用场景

### 1. 快速筛选

用户可以通过业务线标签快速识别不同业务类型的测试点:

- 蓝色标签 → 契约业务
- 绿色标签 → 保全业务
- 橙色标签 → 理赔业务

### 2. 业务分类

在测试点列表中,业务线列帮助用户:

- 了解测试点的业务归属
- 按业务线组织测试工作
- 分配给对应业务线的测试人员

### 3. 测试用例生成

系统会根据业务线自动选择对应的 Prompt:

- 契约业务 → 使用契约业务线 Prompt
- 保全业务 → 使用保全业务线 Prompt
- 理赔业务 → 使用理赔业务线 Prompt

## 技术实现

### 业务线映射配置

```typescript
const businessLineMap: Record<string, { label: string; color: string }> = {
  contract: { label: '契约', color: 'blue' },
  preservation: { label: '保全', color: 'green' },
  claim: { label: '理赔', color: 'orange' },
}
```

### 渲染逻辑

```typescript
render: (businessLine: string) => {
  if (!businessLine) return <Tag color="default">未识别</Tag>
  
  const config = businessLineMap[businessLine] || { 
    label: businessLine, 
    color: 'default' 
  }
  return <Tag color={config.color}>{config.label}</Tag>
}
```

## 数据流程

```
1. 用户上传需求文档
   ↓
2. AI 提取测试点并识别业务线
   ↓
3. 保存测试点(含 business_line 字段)
   ↓
4. 前端获取测试点列表
   ↓
5. 渲染业务线标签
   - contract → 蓝色"契约"
   - preservation → 绿色"保全"
   - claim → 橙色"理赔"
   - null/空 → 灰色"未识别"
```

## 相关文件

### 前端文件

- `frontend/src/pages/TestCases.tsx` - 测试点列表和详情
- `frontend/src/pages/Requirements.tsx` - 需求详情中的测试点列表

### 后端文件

- `backend/app/models/test_point.py` - TestPoint 模型(含 business_line 字段)
- `backend/app/schemas/test_point.py` - TestPoint Schema
- `backend/app/services/ai_service.py` - AI 业务线识别逻辑

## 注意事项

1. **向后兼容**: 现有测试点的 business_line 字段为空,显示为"未识别"
2. **颜色一致性**: 所有页面的业务线标签颜色保持一致
3. **响应式设计**: 表格支持横向滚动,适配不同屏幕尺寸
4. **可扩展性**: 可以轻松添加新的业务线类型

## 未来优化

1. **业务线筛选**: 添加按业务线筛选测试点的功能
2. **业务线统计**: 在仪表板中显示各业务线的测试点数量
3. **业务线编辑**: 允许用户手动修改测试点的业务线
4. **业务线配置**: 支持在系统配置中自定义业务线类型和颜色

## 测试建议

1. **测试契约业务**: 上传契约相关需求,验证业务线识别和显示
2. **测试保全业务**: 上传保全相关需求,验证业务线识别和显示
3. **测试理赔业务**: 上传理赔相关需求,验证业务线识别和显示
4. **测试未识别**: 上传通用需求,验证"未识别"标签显示
5. **测试详情页**: 点击查看测试点详情,验证业务线字段显示

