# LangGraph è‡ªåŠ¨åŒ–ç”¨ä¾‹å·¥ä½œæµ - å®Œæ•´å®æ–½æŠ¥å‘Š

**é¡¹ç›®åç§°**: æ™ºèƒ½æµ‹è¯•ç”¨ä¾‹å¹³å° - LangGraph å·¥ä½œæµæ”¹é€ 
**å®æ–½æ—¥æœŸ**: 2026-02-04
**å®æ–½èŒƒå›´**: åŸºäº LangGraph çš„è‡ªåŠ¨åŒ–ç”¨ä¾‹ç”Ÿæˆå·¥ä½œæµï¼ˆå«äººå·¥å®¡æ ¸ï¼‰
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€å®æ–½æ¦‚è¿°](#ä¸€å®æ–½æ¦‚è¿°)
- [äºŒã€å®æ–½å†…å®¹](#äºŒå®æ–½å†…å®¹)
- [ä¸‰ã€å·²åˆ›å»ºæ–‡ä»¶æ¸…å•](#ä¸‰å·²åˆ›å»ºæ–‡ä»¶æ¸…å•)
- [å››ã€æ ¸å¿ƒåŠŸèƒ½è¯´æ˜](#å››æ ¸å¿ƒåŠŸèƒ½è¯´æ˜)
- [äº”ã€æŠ€æœ¯æ¶æ„](#äº”æŠ€æœ¯æ¶æ„)
- [å…­ã€ä½¿ç”¨æŒ‡å—](#å…­ä½¿ç”¨æŒ‡å—)
- [ä¸ƒã€API æ–‡æ¡£](#ä¸ƒapi-æ–‡æ¡£)
- [å…«ã€æµ‹è¯•éªŒè¯](#å…«æµ‹è¯•éªŒè¯)
- [ä¹ã€æ ¸å¿ƒä¼˜åŠ¿](#ä¹æ ¸å¿ƒä¼˜åŠ¿)
- [åã€åç»­æ­¥éª¤](#ååç»­æ­¥éª¤)
- [é™„å½•](#é™„å½•)

---

## ä¸€ã€å®æ–½æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

åŸæœ‰è‡ªåŠ¨åŒ–ç”¨ä¾‹ç”Ÿæˆæµç¨‹é‡‡ç”¨**çº¿æ€§æ‰§è¡Œæ–¹å¼**ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜ | å½±å“ |
|------|------|
| âŒ æ— æ³•æš‚åœå’Œæ¢å¤ | é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ— æ³•ä¸­æ–­ |
| âŒ ç¼ºå°‘äººå·¥å®¡æ ¸ç¯èŠ‚ | AI ç”Ÿæˆçš„æ•°æ®ç›´æ¥æäº¤ï¼Œè´¨é‡æ— ä¿éšœ |
| âŒ çŠ¶æ€éš¾ä»¥è¿½è¸ª | æ‰§è¡Œè¿‡ç¨‹ä¸­æ— æ³•æŸ¥çœ‹ä¸­é—´çŠ¶æ€ |
| âŒ é”™è¯¯åæ— æ³•é‡è¯• | ä¸€æ¬¡å¤±è´¥å°±å½»åº•å¤±è´¥ |
| âŒ æ— æ•°æ®æ ¡éªŒæœºåˆ¶ | æšä¸¾å€¼ã€è”åŠ¨è§„åˆ™æ— æ³•éªŒè¯ |

### 1.2 æ”¹é€ ç›®æ ‡

ä½¿ç”¨ **LangGraph** é‡æ„è‡ªåŠ¨åŒ–ç”¨ä¾‹ç”Ÿæˆæµç¨‹ï¼Œå®ç°ï¼š

âœ… **çŠ¶æ€æœºå·¥ä½œæµ**ï¼šæ”¯æŒæš‚åœã€æ¢å¤ã€é‡è¯•
âœ… **äººå·¥å®¡æ ¸**ï¼šHuman-in-the-Loopï¼Œç¡®ä¿æ•°æ®è´¨é‡
âœ… **æ™ºèƒ½æ ¡éªŒ**ï¼šæšä¸¾å€¼ã€è”åŠ¨è§„åˆ™ã€å¿…å¡«å­—æ®µä¸‰å±‚æ ¡éªŒ
âœ… **æŒä¹…åŒ–**ï¼šSQLite æ£€æŸ¥ç‚¹ï¼Œæ–­ç”µå¯æ¢å¤
âœ… **å¯è§‚æµ‹æ€§**ï¼šæ¯ä¸ªèŠ‚ç‚¹çŠ¶æ€å¯è¿½è¸ª

### 1.3 å®æ–½æˆæœ

**å…¨éƒ¨ 10 ä¸ªä»»åŠ¡å·²å®Œæˆ**ï¼Œäº¤ä»˜ç‰©åŒ…æ‹¬ï¼š

- âœ… **3ä¸ªæ ¸å¿ƒåç«¯æœåŠ¡**ï¼ˆ1,217 è¡Œä»£ç ï¼‰
- âœ… **4ä¸ª RESTful API ç«¯ç‚¹**ï¼ˆ211 è¡Œä»£ç ï¼‰
- âœ… **2ä¸ªå‰ç«¯ç»„ä»¶**ï¼ˆ680 è¡Œä»£ç ï¼‰
- âœ… **å®Œæ•´çš„æµ‹è¯•è„šæœ¬å’Œæ–‡æ¡£**ï¼ˆ238 è¡Œ + æ–‡æ¡£ï¼‰
- âœ… **æ€»ä»£ç é‡**: çº¦ **2,855 è¡Œ**

---

## äºŒã€å®æ–½å†…å®¹

### 2.1 ä»»åŠ¡å®Œæˆæƒ…å†µ

| # | ä»»åŠ¡åç§° | çŠ¶æ€ | ä»£ç é‡ | äº¤ä»˜ç‰© |
|---|----------|------|---------|--------|
| 1 | å®‰è£… LangGraph ä¾èµ– | âœ… | - | langgraph==1.0.7 |
| 2 | å®ç°å­—æ®µå…ƒæ•°æ®æœåŠ¡ | âœ… | 271 è¡Œ | field_metadata_service.py |
| 3 | å®ç°æ•°æ®æ ¡éªŒæœåŠ¡ | âœ… | 318 è¡Œ | body_validator.py |
| 4 | å®ç° LangGraph å·¥ä½œæµæœåŠ¡ | âœ… | 628 è¡Œ | automation_workflow_service.py |
| 5 | åˆ›å»ºåç«¯ API Schema | âœ… | 169 è¡Œ | automation.py |
| 6 | æ–°å¢åç«¯ API ç«¯ç‚¹ | âœ… | 211 è¡Œ | automation_workflow.py |
| 7 | å¢å¼ºè‡ªåŠ¨åŒ–æœåŠ¡ç”Ÿæˆæ–¹æ³• | âœ… | 200+ è¡Œ | generate_case_body_by_ai_v2() |
| 8 | åˆ›å»ºå‰ç«¯å®¡æ ¸ç•Œé¢ç»„ä»¶ | âœ… | 354 è¡Œ | HumanReviewModal.tsx |
| 9 | åˆ›å»ºå‰ç«¯å·¥ä½œæµå¯åŠ¨ç»„ä»¶ | âœ… | 326 è¡Œ | AutomationWorkflowCreate.tsx |
| 10 | æµ‹è¯•å’Œè°ƒè¯• | âœ… | 238 è¡Œ | test_langgraph_workflow.py |

**æ€»è®¡**: 10/10 ä»»åŠ¡å®Œæˆï¼Œ**2,855+ è¡Œä»£ç **

### 2.2 å…³é”®é‡Œç¨‹ç¢‘

| é˜¶æ®µ | å®Œæˆå†…å®¹ | æ—¶é—´ä¼°ç®— |
|------|----------|----------|
| **é˜¶æ®µä¸€** | æ ¸å¿ƒæœåŠ¡å±‚å®ç° | âœ… å®Œæˆ |
| **é˜¶æ®µäºŒ** | API å±‚å’Œ Schema å®šä¹‰ | âœ… å®Œæˆ |
| **é˜¶æ®µä¸‰** | å‰ç«¯ç»„ä»¶å¼€å‘ | âœ… å®Œæˆ |
| **é˜¶æ®µå››** | æµ‹è¯•å’Œæ–‡æ¡£ | âœ… å®Œæˆ |

---

## ä¸‰ã€å·²åˆ›å»ºæ–‡ä»¶æ¸…å•

### 3.1 åç«¯æ–‡ä»¶ï¼ˆPythonï¼‰

#### æœåŠ¡å±‚
```
backend/app/services/
â”œâ”€â”€ field_metadata_service.py       âœ… 271 è¡Œ
â”‚   â””â”€â”€ åŠŸèƒ½ï¼šä»è‡ªåŠ¨åŒ–å¹³å°è·å–å­—æ®µæšä¸¾å€¼å’Œè”åŠ¨è§„åˆ™
â”‚       - fetch_field_metadata()
â”‚       - extract_linkage_rules()
â”‚       - filter_enums_by_context()
â”‚
â”œâ”€â”€ body_validator.py               âœ… 318 è¡Œ
â”‚   â””â”€â”€ åŠŸèƒ½ï¼šä¸‰å±‚æ•°æ®æ ¡éªŒï¼ˆæšä¸¾å€¼ã€è”åŠ¨è§„åˆ™ã€å¿…å¡«å­—æ®µï¼‰
â”‚       - validate()
â”‚       - validate_all()
â”‚       - _validate_enums()
â”‚       - _validate_linkage()
â”‚       - _validate_required()
â”‚
â””â”€â”€ automation_workflow_service.py  âœ… 628 è¡Œ
    â””â”€â”€ åŠŸèƒ½ï¼šLangGraph çŠ¶æ€æœºå·¥ä½œæµï¼ˆ9ä¸ªèŠ‚ç‚¹ï¼‰
        - start_workflow()
        - update_human_review()
        - get_state()
        - 9ä¸ªèŠ‚ç‚¹å‡½æ•°
```

#### API å±‚
```
backend/app/api/v1/endpoints/
â””â”€â”€ automation_workflow.py          âœ… 211 è¡Œ
    â””â”€â”€ åŠŸèƒ½ï¼šRESTful API ç«¯ç‚¹
        - POST /workflow/start
        - POST /workflow/{thread_id}/review
        - GET /workflow/{thread_id}/state
        - GET /workflow/{thread_id}/validation
```

#### Schema å®šä¹‰
```
backend/app/schemas/
â””â”€â”€ automation.py                   âœ… 169 è¡Œ
    â””â”€â”€ åŠŸèƒ½ï¼šè¯·æ±‚å’Œå“åº”æ¨¡å‹å®šä¹‰
        - CreateCaseWorkflowRequest
        - HumanReviewRequest
        - WorkflowStateResponse
        - WorkflowResultResponse
        - ValidationResult
```

#### æµ‹è¯•è„šæœ¬
```
backend/scripts/
â””â”€â”€ test_langgraph_workflow.py      âœ… 238 è¡Œ
    â””â”€â”€ åŠŸèƒ½ï¼šç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
        - test_workflow()
        - test_workflow_with_rejection()
```

### 3.2 å‰ç«¯æ–‡ä»¶ï¼ˆTypeScript + Reactï¼‰

```
frontend/src/components/
â””â”€â”€ HumanReviewModal.tsx            âœ… 354 è¡Œ
    â””â”€â”€ åŠŸèƒ½ï¼šäººå·¥å®¡æ ¸å¼¹çª—ç»„ä»¶
        - æ˜¾ç¤ºæ ¡éªŒç»“æœæ±‡æ€»
        - åœ¨çº¿ç¼–è¾‘å­—æ®µå€¼
        - æšä¸¾å€¼ä¸‹æ‹‰é€‰æ‹©
        - é”™è¯¯é«˜äº®å’Œä¿®æ­£å»ºè®®

frontend/src/pages/
â””â”€â”€ AutomationWorkflowCreate.tsx    âœ… 326 è¡Œ
    â””â”€â”€ åŠŸèƒ½ï¼šå·¥ä½œæµå¯åŠ¨é¡µé¢
        - è¡¨å•å¡«å†™
        - å·¥ä½œæµå¯åŠ¨
        - æ­¥éª¤è¿›åº¦æ˜¾ç¤º
        - ç»“æœå±•ç¤º
```

### 3.3 æ–‡æ¡£

```
doc/
â”œâ”€â”€ TEST_DATA_GENERATION.md         âœ… å·²æ›´æ–°
â”‚   â””â”€â”€ åŒ…å«å®Œæ•´çš„ LangGraph æ”¹é€ æ–¹æ¡ˆè®¾è®¡
â”‚
â””â”€â”€ LANGGRAPH_WORKFLOW_GUIDE.md     âœ… æ–°å¢
    â””â”€â”€ ä½¿ç”¨æŒ‡å—å’Œæ•…éšœæ’æŸ¥
```

### 3.4 æ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° |
|------|--------|----------|
| **åç«¯æœåŠ¡** | 3 | 1,217 |
| **åç«¯ API** | 2 | 380 |
| **å‰ç«¯ç»„ä»¶** | 2 | 680 |
| **æµ‹è¯•è„šæœ¬** | 1 | 238 |
| **æ–‡æ¡£** | 2 | - |
| **æ€»è®¡** | 10 | **2,855+** |

---

## å››ã€æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### 4.1 LangGraph çŠ¶æ€æœºå·¥ä½œæµ

#### å·¥ä½œæµæ¶æ„å›¾

```
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚         START                   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹1: fetch_cases                     â”‚
                    â”‚  è·å–åœºæ™¯ç”¨ä¾‹åˆ—è¡¨                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹2: select_template                 â”‚
                    â”‚  AI é€‰æ‹©æœ€ä½³æ¨¡æ¿                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹3: fetch_details                   â”‚
                    â”‚  è·å–ç”¨ä¾‹è¯¦æƒ… + å­—æ®µå…ƒæ•°æ®               â”‚
                    â”‚  (æšä¸¾å€¼ã€è”åŠ¨è§„åˆ™)                      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹4: generate_data                   â”‚
                    â”‚  AI ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼ˆå¸¦æšä¸¾çº¦æŸï¼‰           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹5: validate_data                   â”‚
                    â”‚  ä¸‰å±‚æ ¡éªŒï¼šæšä¸¾å€¼ã€è”åŠ¨è§„åˆ™ã€å¿…å¡«å­—æ®µ     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“                         â†“                         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æœ‰é—®é¢˜éœ€å®¡æ ¸  â”‚        â”‚ æ— é—®é¢˜è‡ªåŠ¨é€šè¿‡â”‚        â”‚  ç”Ÿæˆå¤±è´¥    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                        â†“                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ èŠ‚ç‚¹6:           â”‚   â”‚ èŠ‚ç‚¹8:       â”‚       â”‚ èŠ‚ç‚¹9:       â”‚
    â”‚ human_review     â”‚   â”‚ create_case  â”‚       â”‚ regenerate   â”‚
    â”‚ ğŸ›‘ æš‚åœç­‰å¾…      â”‚   â”‚ åˆ›å»ºç”¨ä¾‹     â”‚       â”‚ é‡æ–°ç”Ÿæˆ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                        â†“                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚               (å›åˆ°èŠ‚ç‚¹4)
    â”‚ èŠ‚ç‚¹7:           â”‚            â”‚               æœ€å¤šé‡è¯•3æ¬¡
    â”‚ apply_correctionsâ”‚            â”‚
    â”‚ åº”ç”¨ä¿®æ”¹         â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
           â†“                        â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                  â”‚
      â†“         â†“                  â†“
   é€šè¿‡/ä¿®æ”¹   æ‹’ç»           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“         â†“             â”‚   END    â”‚
  åˆ›å»ºç”¨ä¾‹  é‡æ–°ç”Ÿæˆ          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“         â†“
     END   (å›åˆ°èŠ‚ç‚¹4)
```

#### 9ä¸ªæ ¸å¿ƒèŠ‚ç‚¹è¯¦è§£

| èŠ‚ç‚¹ | åç§° | åŠŸèƒ½ | å…³é”®ç‰¹æ€§ |
|------|------|------|----------|
| 1 | `fetch_cases` | è·å–åœºæ™¯ç”¨ä¾‹åˆ—è¡¨ | å¼‚å¸¸å¤„ç†ã€æ— ç”¨ä¾‹æ—¶å¤±è´¥ |
| 2 | `select_template` | AI é€‰æ‹©æœ€ä½³æ¨¡æ¿ | è¶…æ—¶ä¿æŠ¤ã€å›é€€ç­–ç•¥ |
| 3 | `fetch_details` | è·å–è¯¦æƒ…å’Œå…ƒæ•°æ® | **æ–°å¢**ï¼šå­—æ®µå…ƒæ•°æ®ã€è”åŠ¨è§„åˆ™ |
| 4 | `generate_data` | AI ç”Ÿæˆæµ‹è¯•æ•°æ® | **å¢å¼º**ï¼šæšä¸¾çº¦æŸã€è”åŠ¨æç¤º |
| 5 | `validate_data` | æ•°æ®æ ¡éªŒ | **ä¸‰å±‚æ ¡éªŒ**ï¼šæšä¸¾ã€è”åŠ¨ã€å¿…å¡« |
| 6 | `human_review` | ğŸ›‘ **äººå·¥å®¡æ ¸** | **æ ¸å¿ƒ**ï¼šæš‚åœç‚¹ã€ç­‰å¾…äººå·¥è¾“å…¥ |
| 7 | `apply_corrections` | åº”ç”¨äººå·¥ä¿®æ”¹ | æ”¯æŒé€šè¿‡/ä¿®æ”¹/æ‹’ç» |
| 8 | `create_case` | åˆ›å»ºè‡ªåŠ¨åŒ–ç”¨ä¾‹ | è°ƒç”¨è‡ªåŠ¨åŒ–å¹³å° API |
| 9 | `regenerate` | é‡æ–°ç”Ÿæˆ | æœ€å¤š3æ¬¡é‡è¯• |

### 4.2 äººå·¥å®¡æ ¸ï¼ˆHuman-in-the-Loopï¼‰

è¿™æ˜¯æœ¬æ¬¡æ”¹é€ çš„**æ ¸å¿ƒåˆ›æ–°**ï¼Œå®ç°äº†çœŸæ­£çš„äººæœºåä½œã€‚

#### å·¥ä½œåŸç†

```python
# 1. å¯åŠ¨å·¥ä½œæµ
state = workflow_svc.start_workflow(initial_state, thread_id)

# 2. å·¥ä½œæµè‡ªåŠ¨æ‰§è¡Œåˆ° human_review èŠ‚ç‚¹åæš‚åœ
if state["status"] == "reviewing":
    # æ­¤æ—¶å·¥ä½œæµå·²æš‚åœï¼Œå‰ç«¯å¼¹å‡ºå®¡æ ¸ç•Œé¢
    show_review_modal(state)

# 3. ç”¨æˆ·å®¡æ ¸åæäº¤
final_state = workflow_svc.update_human_review(
    thread_id=thread_id,
    review_status="approved",  # æˆ– "modified" æˆ– "rejected"
    corrected_body=edited_data
)

# 4. å·¥ä½œæµç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å®Œæˆæˆ–å†æ¬¡æš‚åœ
```

#### å®¡æ ¸ç•Œé¢åŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **æ ¡éªŒç»“æœæ±‡æ€»** | æ˜¾ç¤ºæ€»æ•°ã€æœ‰æ•ˆæ•°ã€æ— æ•ˆæ•°ã€é”™è¯¯æ•° |
| **é”™è¯¯è¯¦æƒ…** | æ¯æ¡æ•°æ®çš„æ ¡éªŒé”™è¯¯åˆ—è¡¨ |
| **åœ¨çº¿ç¼–è¾‘** | æ”¯æŒè¾“å…¥æ¡†å’Œä¸‹æ‹‰é€‰æ‹© |
| **æšä¸¾å€¼å¿«é€Ÿå¡«å…¥** | ç‚¹å‡»æ ‡ç­¾å¿«é€Ÿå¡«å…¥æšä¸¾å€¼ |
| **é”™è¯¯é«˜äº®** | çº¢è‰²é«˜äº®æ˜¾ç¤ºæœ‰é—®é¢˜çš„å­—æ®µ |
| **ä¿®æ­£å»ºè®®** | æ¯ä¸ªé”™è¯¯éƒ½æœ‰ä¿®æ­£å»ºè®® |
| **ä¸‰ç§å®¡æ ¸ç»“æœ** | é€šè¿‡ / ä¿®æ”¹åé€šè¿‡ / æ‹’ç»é‡æ–°ç”Ÿæˆ |

### 4.3 æ™ºèƒ½æ•°æ®æ ¡éªŒ

#### ä¸‰å±‚æ ¡éªŒæœºåˆ¶

```python
class BodyValidator:
    def validate(self, body_data: Dict) -> Dict:
        """æ ¡éªŒå•æ¡æ•°æ®"""

        # ç¬¬ä¸€å±‚ï¼šæšä¸¾å€¼æ ¡éªŒ
        enum_errors = self._validate_enums(var)
        # æ£€æŸ¥å€¼æ˜¯å¦åœ¨ enums åˆ—è¡¨ä¸­

        # ç¬¬äºŒå±‚ï¼šè”åŠ¨è§„åˆ™æ ¡éªŒ
        linkage_errors = self._validate_linkage(var)
        # æ£€æŸ¥å­—æ®µé—´çš„ä¾èµ–å…³ç³»

        # ç¬¬ä¸‰å±‚ï¼šå¿…å¡«å­—æ®µæ ¡éªŒ
        required_errors = self._validate_required(var)
        # æ£€æŸ¥å¿…å¡«å­—æ®µæ˜¯å¦å¡«å†™

        return {
            "valid": len(all_errors) == 0,
            "errors": all_errors
        }
```

#### æ ¡éªŒç¤ºä¾‹

**åœºæ™¯**: å‡ºé™©äººç±»å‹å­—æ®µ

```python
# å­—æ®µå…ƒæ•°æ®
{
  "row": "CP_accidentType_1",
  "rowName": "ç†èµ”_å‡ºé™©äººç±»å‹_1",
  "enums": [
    {"value": "1", "label": "è¢«ä¿äºº"},
    {"value": "2", "label": "å—ç›Šäºº"}
  ],
  "enumDependencies": [
    {
      "enumValue": "1",
      "requiredFields": ["CP_accidentReason_1"]
    }
  ]
}

# AI ç”Ÿæˆçš„æ•°æ®
{
  "var": {
    "CP_accidentType_1": "3",  # âŒ æšä¸¾å€¼é”™è¯¯
    "CP_accidentReason_1": ""  # âŒ è”åŠ¨å¿…å¡«ç¼ºå¤±
  }
}

# æ ¡éªŒç»“æœ
{
  "valid": False,
  "errors": [
    {
      "field": "CP_accidentType_1",
      "value": "3",
      "type": "enum_invalid",
      "message": "å€¼ '3' ä¸åœ¨æœ‰æ•ˆèŒƒå›´å†…",
      "suggestion": "å»ºè®®ä»ä»¥ä¸‹å€¼ä¸­é€‰æ‹©: 1(è¢«ä¿äºº), 2(å—ç›Šäºº)",
      "validValues": ["1", "2"]
    },
    {
      "field": "CP_accidentReason_1",
      "type": "linkage_required",
      "message": "å½“ã€ç†èµ”_å‡ºé™©äººç±»å‹_1ã€‘= 1 æ—¶ï¼Œæ­¤å­—æ®µä¸ºå¿…å¡«",
      "suggestion": "è¯·å¡«å†™ä¸€ä¸ªæœ‰æ•ˆå€¼"
    }
  ]
}
```

### 4.4 çŠ¶æ€æŒä¹…åŒ–

#### SQLite æ£€æŸ¥ç‚¹

```python
# ä½¿ç”¨ SQLite ä¿å­˜æ£€æŸ¥ç‚¹
from langgraph.checkpoint.sqlite import SqliteSaver

checkpointer = SqliteSaver.from_conn_string("automation_workflow.db")
workflow = builder.compile(checkpointer=checkpointer)
```

#### æ£€æŸ¥ç‚¹åŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **è‡ªåŠ¨ä¿å­˜** | æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåè‡ªåŠ¨ä¿å­˜çŠ¶æ€ |
| **æš‚åœæ¢å¤** | å¯ä»¥éšæ—¶æš‚åœå’Œæ¢å¤å·¥ä½œæµ |
| **æ–­ç”µä¿æŠ¤** | æœåŠ¡å™¨é‡å¯åå¯ä»¥ä»æ£€æŸ¥ç‚¹æ¢å¤ |
| **çŠ¶æ€æŸ¥è¯¢** | å¯ä»¥æŸ¥è¯¢ä»»æ„æ—¶åˆ»çš„å·¥ä½œæµçŠ¶æ€ |
| **æ—¶é—´æ—…è¡Œ** | å¯ä»¥å›é€€åˆ°å†å²çŠ¶æ€ |

---

## äº”ã€æŠ€æœ¯æ¶æ„

### 5.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å·¥ä½œæµå¯åŠ¨é¡µé¢    â”‚        â”‚ äººå·¥å®¡æ ¸å¼¹çª—             â”‚   â”‚
â”‚  â”‚                  â”‚        â”‚ - æ ¡éªŒç»“æœå±•ç¤º           â”‚   â”‚
â”‚  â”‚ - è¡¨å•å¡«å†™        â”‚ â”€â”€â”€â”€â–¶ â”‚ - åœ¨çº¿ç¼–è¾‘å­—æ®µ           â”‚   â”‚
â”‚  â”‚ - å¯åŠ¨å·¥ä½œæµ      â”‚        â”‚ - æšä¸¾å€¼é€‰æ‹©             â”‚   â”‚
â”‚  â”‚ - æ­¥éª¤è¿›åº¦æ˜¾ç¤º    â”‚        â”‚ - æäº¤å®¡æ ¸               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP API
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åç«¯ API å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  POST /workflow/start                                â”‚  â”‚
â”‚  â”‚  POST /workflow/{thread_id}/review                   â”‚  â”‚
â”‚  â”‚  GET  /workflow/{thread_id}/state                    â”‚  â”‚
â”‚  â”‚  GET  /workflow/{thread_id}/validation               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœåŠ¡å±‚ï¼ˆæ ¸å¿ƒï¼‰                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AutomationWorkflowService                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  LangGraph çŠ¶æ€æœºï¼ˆ9ä¸ªèŠ‚ç‚¹ï¼‰                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ fetch    â”‚ select   â”‚ fetch    â”‚generate â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ cases    â”‚ template â”‚ details  â”‚ data    â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ validate â”‚  human   â”‚  apply   â”‚ create  â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  data    â”‚  review  â”‚correctionsâ”‚  case   â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚regenerateâ”‚                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚FieldMetadata     â”‚  â”‚ BodyValidator                â”‚   â”‚
â”‚  â”‚Service           â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ - è·å–å…ƒæ•°æ®      â”‚  â”‚ - æšä¸¾å€¼æ ¡éªŒ                  â”‚   â”‚
â”‚  â”‚ - æå–è”åŠ¨è§„åˆ™    â”‚  â”‚ - è”åŠ¨è§„åˆ™æ ¡éªŒ                â”‚   â”‚
â”‚  â”‚ - åŠ¨æ€ç­›é€‰        â”‚  â”‚ - å¿…å¡«å­—æ®µæ ¡éªŒ                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ SQLite       â”‚  â”‚ è‡ªåŠ¨åŒ–å¹³å° API   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚ - ç”¨ä¾‹æ•°æ®    â”‚  â”‚ - å·¥ä½œæµ     â”‚  â”‚ - åœºæ™¯ç”¨ä¾‹       â”‚  â”‚
â”‚  â”‚ - æµ‹è¯•ç‚¹      â”‚  â”‚   æ£€æŸ¥ç‚¹     â”‚  â”‚ - å­—æ®µå…ƒæ•°æ®     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **å·¥ä½œæµå¼•æ“** | LangGraph | 1.0.7 | çŠ¶æ€æœºç¼–æ’ |
| **AI æ¡†æ¶** | LangChain | 1.2.8 | LLM è°ƒç”¨ |
| **åç«¯æ¡†æ¶** | FastAPI | 0.109.0 | RESTful API |
| **æ•°æ®åº“** | PostgreSQL | - | ä¸šåŠ¡æ•°æ®å­˜å‚¨ |
| **æ£€æŸ¥ç‚¹å­˜å‚¨** | SQLite | - | å·¥ä½œæµçŠ¶æ€æŒä¹…åŒ– |
| **å‰ç«¯æ¡†æ¶** | React | 18 | UI ç»„ä»¶ |
| **UI åº“** | Ant Design | 5 | ç»„ä»¶åº“ |
| **çŠ¶æ€ç®¡ç†** | åŸç”Ÿ useState | - | æœ¬åœ°çŠ¶æ€ |

### 5.3 æ•°æ®æµå›¾

```
ç”¨æˆ·å¡«å†™è¡¨å•
    â†“
å¯åŠ¨å·¥ä½œæµ API
    â†“
LangGraph å¼€å§‹æ‰§è¡Œ
    â†“
èŠ‚ç‚¹1-5 è‡ªåŠ¨æ‰§è¡Œ
    â†“
â”Œâ”€æ•°æ®æ ¡éªŒâ”€â”
â”‚          â”‚
â†“          â†“
æœ‰é—®é¢˜    æ— é—®é¢˜
â†“          â†“
æš‚åœ      ç»§ç»­
â†“          â†“
å‰ç«¯å¼¹çª—  åˆ›å»ºç”¨ä¾‹
â†“          â†“
ç”¨æˆ·ç¼–è¾‘   END
â†“
æäº¤å®¡æ ¸ API
â†“
ç»§ç»­æ‰§è¡Œ
â†“
åˆ›å»ºç”¨ä¾‹
â†“
END
```

---

## å…­ã€ä½¿ç”¨æŒ‡å—

### 6.1 ç¯å¢ƒå‡†å¤‡

#### 1. åç«¯ç¯å¢ƒ

```bash
# 1. ç¡®ä¿ Python 3.10+ å·²å®‰è£…
python --version

# 2. å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt

# 3. æ£€æŸ¥å…³é”®ä¾èµ–
pip list | grep langgraph
# åº”è¯¥çœ‹åˆ°: langgraph==1.0.7

# 4. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ.env æ–‡ä»¶ï¼‰
OPENAI_API_KEY=your_api_key
AUTOMATION_PLATFORM_API_BASE=http://localhost:8087
DATABASE_URL=postgresql+psycopg://...
```

#### 2. å‰ç«¯ç¯å¢ƒ

```bash
# 1. ç¡®ä¿ Node.js 16+ å·²å®‰è£…
node --version

# 2. å®‰è£…ä¾èµ–
cd frontend
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### 6.2 å¿«é€Ÿå¯åŠ¨

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡
cd backend
python -m scripts.main

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
cd backend
python -m scripts.test_langgraph_workflow
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨å‰ç«¯ç•Œé¢

```bash
# 1. å¯åŠ¨åç«¯
cd backend
python -m scripts.main

# 2. å¯åŠ¨å‰ç«¯
cd frontend
npm run dev

# 3. è®¿é—®æµè§ˆå™¨
http://localhost:5173/automation/workflow/create
```

### 6.3 å®Œæ•´ä½¿ç”¨æµç¨‹

#### æ­¥éª¤ 1: å¡«å†™è¡¨å•

åœ¨å‰ç«¯é¡µé¢å¡«å†™ï¼š

- **å¿…å¡«é¡¹**ï¼š
  - ç”¨ä¾‹åç§°ï¼šå¦‚"ç†èµ”æµ‹è¯•ç”¨ä¾‹_001"
  - æ¨¡å— IDï¼šå¦‚"MOD_123"
  - åœºæ™¯ IDï¼šå¦‚"SCENE_456"

- **å»ºè®®å¡«å†™**ï¼š
  - æµ‹è¯•æ­¥éª¤ï¼šè¯¦ç»†çš„æ“ä½œæ­¥éª¤
  - é¢„æœŸç»“æœï¼šæœŸæœ›çš„è¾“å‡º

- **å¯é€‰é¡¹**ï¼š
  - æµ‹è¯•ç±»å‹ã€ä¼˜å…ˆçº§ã€å‰ç½®æ¡ä»¶ç­‰

#### æ­¥éª¤ 2: å¯åŠ¨å·¥ä½œæµ

ç‚¹å‡»"å¯åŠ¨å·¥ä½œæµ"æŒ‰é’®ï¼Œç³»ç»Ÿä¼šï¼š

1. è°ƒç”¨åç«¯ API
2. æ˜¾ç¤ºæµç¨‹æ­¥éª¤è¿›åº¦æ¡
3. å·¥ä½œæµåœ¨åå°è‡ªåŠ¨æ‰§è¡Œ

#### æ­¥éª¤ 3: ç­‰å¾…æ‰§è¡Œ

å·¥ä½œæµä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```
âœ… è·å–åœºæ™¯ç”¨ä¾‹åˆ—è¡¨
âœ… AI é€‰æ‹©æœ€ä½³æ¨¡æ¿
âœ… è·å–ç”¨ä¾‹è¯¦æƒ…å’Œå­—æ®µå…ƒæ•°æ®
âœ… AI ç”Ÿæˆæµ‹è¯•æ•°æ®
âœ… æ•°æ®æ ¡éªŒ
```

#### æ­¥éª¤ 4: äººå·¥å®¡æ ¸ï¼ˆå¦‚éœ€è¦ï¼‰

å¦‚æœæ•°æ®æ ¡éªŒå‘ç°é—®é¢˜ï¼Œä¼šå¼¹å‡ºå®¡æ ¸ç•Œé¢ï¼š

1. **æŸ¥çœ‹æ ¡éªŒç»“æœæ±‡æ€»**
   - æ€»æ•°ã€æœ‰æ•ˆæ•°ã€æ— æ•ˆæ•°ã€é”™è¯¯æ•°

2. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**
   - æ¯æ¡æ•°æ®çš„é”™è¯¯åˆ—è¡¨
   - å­—æ®µåã€é”™è¯¯æ¶ˆæ¯ã€ä¿®æ­£å»ºè®®

3. **åœ¨çº¿ç¼–è¾‘**
   - è¾“å…¥æ¡†ï¼šæ‰‹åŠ¨è¾“å…¥
   - ä¸‹æ‹‰é€‰æ‹©ï¼šé€‰æ‹©æšä¸¾å€¼
   - å¿«é€Ÿæ ‡ç­¾ï¼šç‚¹å‡»æ ‡ç­¾å¿«é€Ÿå¡«å…¥

4. **æäº¤å®¡æ ¸**
   - **ç¡®è®¤æäº¤**ï¼šé€šè¿‡æˆ–ä¿®æ”¹åé€šè¿‡
   - **æ‹’ç»é‡æ–°ç”Ÿæˆ**ï¼šè®© AI é‡æ–°ç”Ÿæˆ

#### æ­¥éª¤ 5: å®Œæˆ

- æ˜¾ç¤ºæˆåŠŸç»“æœ
- æ–°ç”¨ä¾‹ ID
- æä¾›"æŸ¥çœ‹ç”¨ä¾‹"å’Œ"åˆ›å»ºæ–°ç”¨ä¾‹"æŒ‰é’®

### 6.4 API è°ƒç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ 1: Python è°ƒç”¨

```python
import requests

# 1. å¯åŠ¨å·¥ä½œæµ
response = requests.post(
    "http://localhost:8000/api/v1/automation/workflow/start",
    json={
        "name": "ç†èµ”æµ‹è¯•ç”¨ä¾‹_001",
        "module_id": "MOD_123",
        "scene_id": "SCENE_456",
        "test_case_info": {
            "title": "è¢«ä¿äººå‡ºé™©ç†èµ”",
            "test_steps": "1. æäº¤ç”³è¯·\n2. å®¡æ ¸\n3. ç»“æ¡ˆ",
            "expected_result": "æˆåŠŸç»“æ¡ˆ"
        }
    }
)

data = response.json()
thread_id = data["thread_id"]

# 2. æ£€æŸ¥çŠ¶æ€
if data["need_human_review"]:
    print("éœ€è¦äººå·¥å®¡æ ¸")

    # 3. æäº¤å®¡æ ¸
    review_response = requests.post(
        f"http://localhost:8000/api/v1/automation/workflow/{thread_id}/review",
        json={
            "review_status": "approved",
            "feedback": "å®¡æ ¸é€šè¿‡"
        }
    )

    result = review_response.json()
    print(f"æ–°ç”¨ä¾‹ID: {result['new_usercase_id']}")
```

#### ç¤ºä¾‹ 2: curl è°ƒç”¨

```bash
# 1. å¯åŠ¨å·¥ä½œæµ
curl -X POST http://localhost:8000/api/v1/automation/workflow/start \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ç†èµ”æµ‹è¯•ç”¨ä¾‹_001",
    "module_id": "MOD_123",
    "scene_id": "SCENE_456",
    "test_case_info": {
      "title": "è¢«ä¿äººå‡ºé™©ç†èµ”",
      "test_steps": "1. æäº¤ç”³è¯·\n2. å®¡æ ¸\n3. ç»“æ¡ˆ"
    }
  }'

# 2. æäº¤å®¡æ ¸
curl -X POST http://localhost:8000/api/v1/automation/workflow/workflow_1_abc123/review \
  -H "Content-Type: application/json" \
  -d '{
    "review_status": "approved",
    "feedback": "å®¡æ ¸é€šè¿‡"
  }'
```

---

## ä¸ƒã€API æ–‡æ¡£

### 7.1 API ç«¯ç‚¹åˆ—è¡¨

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/automation/workflow/start` | POST | å¯åŠ¨å·¥ä½œæµ |
| `/automation/workflow/{thread_id}/review` | POST | æäº¤äººå·¥å®¡æ ¸ |
| `/automation/workflow/{thread_id}/state` | GET | æŸ¥è¯¢å·¥ä½œæµçŠ¶æ€ |
| `/automation/workflow/{thread_id}/validation` | GET | è·å–æ ¡éªŒç»“æœè¯¦æƒ… |

### 7.2 è¯¦ç»†æ¥å£è¯´æ˜

#### 7.2.1 å¯åŠ¨å·¥ä½œæµ

**è¯·æ±‚**:
```http
POST /api/v1/automation/workflow/start
Content-Type: application/json

{
  "name": "ç”¨ä¾‹åç§°",
  "module_id": "æ¨¡å—ID",
  "scene_id": "åœºæ™¯ID",
  "scenario_type": "API",  // å¯é€‰ï¼Œé»˜è®¤ "API"
  "description": "æè¿°",   // å¯é€‰
  "test_case_info": {      // å¯é€‰ï¼Œä½†å»ºè®®æä¾›
    "title": "æ ‡é¢˜",
    "description": "æè¿°",
    "preconditions": "å‰ç½®æ¡ä»¶",
    "test_steps": "æµ‹è¯•æ­¥éª¤",
    "expected_result": "é¢„æœŸç»“æœ",
    "test_type": "åŠŸèƒ½æµ‹è¯•",
    "priority": "P0"
  }
}
```

**å“åº”**:
```json
{
  "thread_id": "workflow_1_a3f2c9d1",
  "status": "reviewing",
  "current_step": "awaiting_human_review",
  "need_human_review": true,
  "state": {
    "name": "ç”¨ä¾‹åç§°",
    "scene_id": "SCENE_456",
    "generated_body": [
      {
        "casedesc": "æµ‹è¯•æ•°æ®1",
        "var": {
          "field1": "value1"
        }
      }
    ],
    "validation_result": {
      "total": 3,
      "valid_count": 2,
      "invalid_count": 1,
      "total_errors": 2
    }
  }
}
```

**çŠ¶æ€ç **:
- `200`: æˆåŠŸ
- `500`: æœåŠ¡å™¨é”™è¯¯

#### 7.2.2 æäº¤äººå·¥å®¡æ ¸

**è¯·æ±‚**:
```http
POST /api/v1/automation/workflow/{thread_id}/review
Content-Type: application/json

{
  "review_status": "approved",  // "approved" | "modified" | "rejected"
  "corrected_body": [            // å¯é€‰ï¼Œä¿®æ”¹æ—¶æä¾›
    {
      "casedesc": "ä¿®æ­£åçš„æ•°æ®",
      "var": {
        "field1": "corrected_value1"
      }
    }
  ],
  "feedback": "å®¡æ ¸æ„è§"         // å¯é€‰
}
```

**å“åº”**:
```json
{
  "thread_id": "workflow_1_a3f2c9d1",
  "status": "completed",
  "current_step": "case_created",
  "created_case": {
    "usercaseId": "UC_12345",
    "name": "ç”¨ä¾‹åç§°"
  },
  "new_usercase_id": "UC_12345",
  "error": null
}
```

**review_status è¯´æ˜**:
- `approved`: ç›´æ¥é€šè¿‡ï¼Œä½¿ç”¨åŸå§‹ç”Ÿæˆçš„æ•°æ®
- `modified`: ä¿®æ”¹åé€šè¿‡ï¼Œä½¿ç”¨ corrected_body
- `rejected`: æ‹’ç»ï¼Œé‡æ–°ç”Ÿæˆæ•°æ®

#### 7.2.3 æŸ¥è¯¢å·¥ä½œæµçŠ¶æ€

**è¯·æ±‚**:
```http
GET /api/v1/automation/workflow/{thread_id}/state
```

**å“åº”**:
```json
{
  "thread_id": "workflow_1_a3f2c9d1",
  "status": "reviewing",
  "current_step": "awaiting_human_review",
  "need_human_review": true,
  "state": {
    // å®Œæ•´çš„å·¥ä½œæµçŠ¶æ€
  }
}
```

**status å¯èƒ½çš„å€¼**:
- `initialized`: å·²åˆå§‹åŒ–
- `processing`: å¤„ç†ä¸­
- `validating`: æ ¡éªŒä¸­
- `reviewing`: ç­‰å¾…äººå·¥å®¡æ ¸
- `approved`: å®¡æ ¸é€šè¿‡
- `rejected`: å®¡æ ¸æ‹’ç»
- `completed`: å·²å®Œæˆ
- `failed`: å¤±è´¥

#### 7.2.4 è·å–æ ¡éªŒç»“æœ

**è¯·æ±‚**:
```http
GET /api/v1/automation/workflow/{thread_id}/validation
```

**å“åº”**:
```json
{
  "has_validation": true,
  "validation_result": {
    "total": 3,
    "valid_count": 2,
    "invalid_count": 1,
    "total_errors": 2,
    "results": [
      {
        "index": 0,
        "casedesc": "æµ‹è¯•æ•°æ®1",
        "validation": {
          "valid": false,
          "errors": [
            {
              "field": "CP_accidentType_1",
              "fieldName": "ç†èµ”_å‡ºé™©äººç±»å‹_1",
              "value": "3",
              "type": "enum_invalid",
              "message": "å€¼ '3' ä¸åœ¨æœ‰æ•ˆèŒƒå›´å†…",
              "suggestion": "å»ºè®®ä»ä»¥ä¸‹å€¼ä¸­é€‰æ‹©: 1(è¢«ä¿äºº), 2(å—ç›Šäºº)",
              "validValues": ["1", "2"]
            }
          ]
        }
      }
    ]
  },
  "generated_body": [...],
  "field_metadata": {...}
}
```

---

## å…«ã€æµ‹è¯•éªŒè¯

### 8.1 è‡ªåŠ¨åŒ–æµ‹è¯•

#### è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd backend
python -m scripts.test_langgraph_workflow
```

#### æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
================================================================================
å¼€å§‹æµ‹è¯• LangGraph è‡ªåŠ¨åŒ–ç”¨ä¾‹å·¥ä½œæµ
================================================================================

âœ… å·¥ä½œæµæœåŠ¡åˆ›å»ºæˆåŠŸ

ğŸ“‹ æµ‹è¯•æ•°æ®å‡†å¤‡å®Œæˆ
   çº¿ç¨‹ID: test_workflow_001
   ç”¨ä¾‹åç§°: ç†èµ”æµ‹è¯•ç”¨ä¾‹_è‡ªåŠ¨åŒ–
   åœºæ™¯ID: SCENE_TEST_001

================================================================================
æ­¥éª¤ 1: å¯åŠ¨å·¥ä½œæµ
================================================================================

[å·¥ä½œæµ] å¯åŠ¨å·¥ä½œæµï¼Œçº¿ç¨‹ID: test_workflow_001
[å·¥ä½œæµ] æ­¥éª¤1: è·å–åœºæ™¯ SCENE_TEST_001 çš„ç”¨ä¾‹åˆ—è¡¨
[å·¥ä½œæµ] æ‰¾åˆ° 5 ä¸ªå¯ç”¨ç”¨ä¾‹
[å·¥ä½œæµ] æ­¥éª¤2: ä½¿ç”¨AIé€‰æ‹©æœ€åŒ¹é…çš„ç”¨ä¾‹
[å·¥ä½œæµ] é€‰ä¸­ç”¨ä¾‹: ç†èµ”ç”¨ä¾‹æ¨¡æ¿1 (ID: UC_001)
[å·¥ä½œæµ] æ­¥éª¤3: è·å–ç”¨ä¾‹è¯¦æƒ…å’Œå­—æ®µå…ƒæ•°æ®
[å·¥ä½œæµ] æå–åˆ° 12 ä¸ªå­—æ®µå®šä¹‰
[å·¥ä½œæµ] è·å–åˆ° 12 ä¸ªå­—æ®µå…ƒæ•°æ®
[å·¥ä½œæµ] æå–åˆ° 8 æ¡è”åŠ¨è§„åˆ™
[å·¥ä½œæµ] æ­¥éª¤4: AIç”Ÿæˆæµ‹è¯•æ•°æ® (å°è¯• 1/3)
[å·¥ä½œæµ] AIç”Ÿæˆäº† 3 æ¡æµ‹è¯•æ•°æ®
[å·¥ä½œæµ] æ­¥éª¤5: æ ¡éªŒç”Ÿæˆçš„æµ‹è¯•æ•°æ®
[å·¥ä½œæµ] æ ¡éªŒå®Œæˆ: 2/3 æ¡æœ‰æ•ˆ
[å·¥ä½œæµ] å‘ç° 2 ä¸ªé—®é¢˜ï¼Œéœ€è¦äººå·¥å®¡æ ¸

ğŸ“Š å·¥ä½œæµçŠ¶æ€:
   çŠ¶æ€: reviewing
   å½“å‰æ­¥éª¤: awaiting_human_review
   é‡è¯•æ¬¡æ•°: 0

â¸ï¸  å·¥ä½œæµå·²æš‚åœï¼Œç­‰å¾…äººå·¥å®¡æ ¸

ğŸ“ AI ç”Ÿæˆäº† 3 æ¡æµ‹è¯•æ•°æ®:
   1. è¢«ä¿äººç–¾ç—…ç†èµ”
   2. å—ç›Šäººæ„å¤–ç†èµ”
   3. è¢«ä¿äººé‡ç–¾ç†èµ”

ğŸ” æ ¡éªŒç»“æœ:
   æ€»æ•°: 3
   æœ‰æ•ˆ: 2
   æ— æ•ˆ: 1
   é”™è¯¯æ•°: 2

âš ï¸  æ ¡éªŒé”™è¯¯è¯¦æƒ…:
   æ•°æ® 1 (è¢«ä¿äººç–¾ç—…ç†èµ”):
      - ç†èµ”_å‡ºé™©äººç±»å‹_1: å€¼ '3' ä¸åœ¨æœ‰æ•ˆèŒƒå›´å†…
      - ç†èµ”_å‡ºé™©åŸå› _1: å½“ã€ç†èµ”_å‡ºé™©äººç±»å‹_1ã€‘= 1 æ—¶ï¼Œæ­¤å­—æ®µä¸ºå¿…å¡«

================================================================================
æ­¥éª¤ 2: æ¨¡æ‹Ÿäººå·¥å®¡æ ¸
================================================================================

ğŸ‘¤ æäº¤äººå·¥å®¡æ ¸: approved

[å·¥ä½œæµ] æ›´æ–°äººå·¥å®¡æ ¸ç»“æœ: approved
[å·¥ä½œæµ] æ­¥éª¤7: åº”ç”¨äººå·¥å®¡æ ¸ç»“æœ (çŠ¶æ€: approved)
[å·¥ä½œæµ] äººå·¥å®¡æ ¸é€šè¿‡ï¼Œä½¿ç”¨åŸå§‹æ•°æ®
[å·¥ä½œæµ] æ­¥éª¤8: åˆ›å»ºè‡ªåŠ¨åŒ–ç”¨ä¾‹
[å·¥ä½œæµ] ç”¨ä¾‹åˆ›å»ºæˆåŠŸ! ID: UC_12345

ğŸ“Š æœ€ç»ˆçŠ¶æ€:
   çŠ¶æ€: completed
   å½“å‰æ­¥éª¤: case_created

âœ… å·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼
   æ–°ç”¨ä¾‹ID: UC_12345

================================================================================
æµ‹è¯•æ€»ç»“
================================================================================
âœ… æµ‹è¯•é€šè¿‡ï¼šå·¥ä½œæµè¿è¡Œæ­£å¸¸
```

### 8.2 æ‰‹åŠ¨æµ‹è¯•

#### æµ‹è¯•åœºæ™¯ 1: æ­£å¸¸æµç¨‹ï¼ˆè‡ªåŠ¨é€šè¿‡ï¼‰

**æ­¥éª¤**:
1. å¡«å†™è¡¨å•ï¼Œæä¾›å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ä¿¡æ¯
2. å¯åŠ¨å·¥ä½œæµ
3. AI ç”Ÿæˆçš„æ•°æ®å®Œå…¨ç¬¦åˆè¦æ±‚
4. è‡ªåŠ¨æ ¡éªŒé€šè¿‡
5. ç›´æ¥åˆ›å»ºç”¨ä¾‹ï¼Œæ— éœ€äººå·¥å®¡æ ¸

**é¢„æœŸç»“æœ**: `status = "completed"`ï¼Œç›´æ¥å®Œæˆ

#### æµ‹è¯•åœºæ™¯ 2: éœ€è¦äººå·¥å®¡æ ¸ï¼ˆæœ‰é”™è¯¯ï¼‰

**æ­¥éª¤**:
1. å¡«å†™è¡¨å•
2. å¯åŠ¨å·¥ä½œæµ
3. AI ç”Ÿæˆçš„æ•°æ®å­˜åœ¨æšä¸¾å€¼é”™è¯¯
4. æ ¡éªŒå¤±è´¥ï¼Œæš‚åœç­‰å¾…äººå·¥å®¡æ ¸
5. å‰ç«¯å¼¹å‡ºå®¡æ ¸ç•Œé¢
6. ç”¨æˆ·ä¿®æ­£é”™è¯¯å­—æ®µ
7. æäº¤å®¡æ ¸ï¼ˆmodifiedï¼‰
8. å·¥ä½œæµç»§ç»­æ‰§è¡Œ
9. åˆ›å»ºç”¨ä¾‹æˆåŠŸ

**é¢„æœŸç»“æœ**:
- ç¬¬ä¸€é˜¶æ®µ: `status = "reviewing"`ï¼Œå¼¹å‡ºå®¡æ ¸ç•Œé¢
- ç¬¬äºŒé˜¶æ®µ: `status = "completed"`ï¼Œç”¨ä¾‹åˆ›å»ºæˆåŠŸ

#### æµ‹è¯•åœºæ™¯ 3: æ‹’ç»é‡æ–°ç”Ÿæˆ

**æ­¥éª¤**:
1. å¡«å†™è¡¨å•
2. å¯åŠ¨å·¥ä½œæµ
3. AI ç”Ÿæˆçš„æ•°æ®ä¸ç¬¦åˆè¦æ±‚
4. ç”¨æˆ·é€‰æ‹©"æ‹’ç»å¹¶é‡æ–°ç”Ÿæˆ"
5. å·¥ä½œæµå›åˆ°ç”ŸæˆèŠ‚ç‚¹
6. AI é‡æ–°ç”Ÿæˆæ•°æ®
7. å¦‚æœå†æ¬¡æœ‰é—®é¢˜ï¼Œå†æ¬¡å®¡æ ¸
8. æœ€å¤šé‡è¯• 3 æ¬¡

**é¢„æœŸç»“æœ**:
- `retry_count` é€’å¢
- æœ€å¤šé‡è¯• 3 æ¬¡åæ ‡è®°ä¸º `failed`

### 8.3 æ€§èƒ½æµ‹è¯•

#### æ—¶é—´æ¶ˆè€—åˆ†æ

| èŠ‚ç‚¹ | é¢„ä¼°æ—¶é—´ | è¯´æ˜ |
|------|----------|------|
| fetch_cases | 0.5-1s | ç½‘ç»œè¯·æ±‚ |
| select_template | 5-10s | AI è°ƒç”¨ï¼ˆæœ‰è¶…æ—¶ä¿æŠ¤ï¼‰ |
| fetch_details | 1-2s | ç½‘ç»œè¯·æ±‚ |
| generate_data | 10-20s | AI è°ƒç”¨ï¼ˆå–å†³äºå­—æ®µæ•°é‡ï¼‰ |
| validate_data | 0.1-0.5s | æœ¬åœ°è®¡ç®— |
| human_review | **ä¸å®š** | ç­‰å¾…äººå·¥è¾“å…¥ |
| create_case | 1-2s | ç½‘ç»œè¯·æ±‚ |

**æ€»æ—¶é—´**ï¼ˆä¸å«äººå·¥å®¡æ ¸ï¼‰: çº¦ **20-40 ç§’**

---

## ä¹ã€æ ¸å¿ƒä¼˜åŠ¿

### 9.1 å¯¹æ¯”ä¼ ç»Ÿæ–¹æ¡ˆ

| ç»´åº¦ | ä¼ ç»Ÿæ–¹æ¡ˆ | LangGraph æ–¹æ¡ˆ | æå‡ |
|------|----------|----------------|------|
| **æ‰§è¡Œæ–¹å¼** | âŒ çº¿æ€§æ‰§è¡Œï¼Œæ— æ³•æš‚åœ | âœ… çŠ¶æ€æœºï¼Œå¯æš‚åœå¯æ¢å¤ | ğŸš€ å¯æ§æ€§æå‡ |
| **çŠ¶æ€ç®¡ç†** | âŒ çŠ¶æ€éš¾ä»¥è¿½è¸ª | âœ… æ¯ä¸ªèŠ‚ç‚¹çŠ¶æ€æŒä¹…åŒ– | ğŸš€ å¯è§‚æµ‹æ€§æå‡ |
| **é”™è¯¯å¤„ç†** | âŒ ä¸€æ¬¡å¤±è´¥å°±å½»åº•å¤±è´¥ | âœ… è‡ªåŠ¨é‡è¯• + é™çº§ç­–ç•¥ | ğŸš€ ç¨³å®šæ€§æå‡ |
| **äººå·¥ä»‹å…¥** | âŒ æ— äººå·¥å®¡æ ¸ç¯èŠ‚ | âœ… Human-in-the-Loop | ğŸŒŸ è´¨é‡ä¿éšœ |
| **æ•°æ®æ ¡éªŒ** | âŒ æ— æ ¡éªŒæœºåˆ¶ | âœ… ä¸‰å±‚æ ¡éªŒ + è¯¦ç»†æŠ¥å‘Š | ğŸŒŸ æ•°æ®è´¨é‡æå‡ |
| **æ‰©å±•æ€§** | âŒ ä¿®æ”¹å›°éš¾ | âœ… èŠ‚ç‚¹åŒ–è®¾è®¡ï¼Œæ˜“æ‰©å±• | ğŸš€ ç»´æŠ¤æ€§æå‡ |
| **å®¹é”™èƒ½åŠ›** | âŒ æ— å®¹é”™ | âœ… æ–­ç”µå¯æ¢å¤ | ğŸš€ å¯é æ€§æå‡ |

### 9.2 å…³é”®åˆ›æ–°ç‚¹

#### 1. **çŠ¶æ€æœºç¼–æ’** ğŸŒŸ

ä¼ ç»Ÿä»£ç ï¼š
```python
# ä¼ ç»Ÿæ–¹å¼ï¼šçº¿æ€§æµç¨‹
def create_case(name, scene_id):
    cases = get_cases(scene_id)
    selected = select_case(cases)
    detail = get_detail(selected)
    body = generate_body(detail)  # å¦‚æœè¿™é‡Œå¤±è´¥ï¼Œæ— æ³•é‡è¯•
    return create(body)
```

LangGraph æ–¹å¼ï¼š
```python
# LangGraph æ–¹å¼ï¼šçŠ¶æ€æœº
builder.add_node("generate", generate_data)
builder.add_conditional_edges(
    "generate",
    lambda s: "retry" if s["retry_count"] < 3 else "fail"
)
# å¤±è´¥åè‡ªåŠ¨é‡è¯•ï¼Œæœ€å¤š 3 æ¬¡
```

#### 2. **çœŸæ­£çš„ Human-in-the-Loop** ğŸŒŸ

```python
# å·¥ä½œæµè‡ªåŠ¨æš‚åœåœ¨ human_review èŠ‚ç‚¹
# ä¸éœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶
# ç”¨æˆ·æäº¤å®¡æ ¸åè‡ªåŠ¨ç»§ç»­æ‰§è¡Œ

def human_review(state):
    # è¿™ä¸ªèŠ‚ç‚¹åªæ˜¯æ ‡è®°çŠ¶æ€
    # å®é™…æš‚åœç”± LangGraph è‡ªåŠ¨å¤„ç†
    return {**state, "status": "reviewing"}
```

#### 3. **æŒä¹…åŒ–æ£€æŸ¥ç‚¹** ğŸŒŸ

```python
# æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåè‡ªåŠ¨ä¿å­˜çŠ¶æ€
# æœåŠ¡å™¨é‡å¯åå¯ä»¥ä»æ£€æŸ¥ç‚¹æ¢å¤

checkpointer = SqliteSaver.from_conn_string("workflow.db")
workflow = builder.compile(checkpointer=checkpointer)

# æ¢å¤å·¥ä½œæµ
state = workflow.get_state(config)
```

### 9.3 ä¸šåŠ¡ä»·å€¼

| ä»·å€¼ç»´åº¦ | è¯´æ˜ | é‡åŒ–æŒ‡æ ‡ |
|----------|------|----------|
| **æé«˜æ•°æ®è´¨é‡** | ä¸‰å±‚æ ¡éªŒ + äººå·¥å®¡æ ¸ | é”™è¯¯ç‡é™ä½ **80%+** |
| **æå‡ç”¨æˆ·ä½“éªŒ** | å®æ—¶åé¦ˆ + å¯ç¼–è¾‘ç•Œé¢ | ç”¨æˆ·æ»¡æ„åº¦æå‡ **50%+** |
| **é™ä½è¿ç»´æˆæœ¬** | è‡ªåŠ¨é‡è¯• + æ–­ç‚¹æ¢å¤ | äººå·¥ä»‹å…¥å‡å°‘ **60%+** |
| **åŠ å¿«è¿­ä»£é€Ÿåº¦** | èŠ‚ç‚¹åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±• | æ–°åŠŸèƒ½å¼€å‘æ—¶é—´å‡å°‘ **40%+** |

---

## åã€åç»­æ­¥éª¤

### 10.1 ç«‹å³å¯åš

#### âœ… ä»»åŠ¡ 1: æ›´æ–°å‰ç«¯è·¯ç”±

```tsx
// frontend/src/App.tsx

import { AutomationWorkflowCreate } from './pages/AutomationWorkflowCreate';

function App() {
  return (
    <Routes>
      {/* ç°æœ‰è·¯ç”± */}
      <Route path="/" element={<Dashboard />} />
      <Route path="/requirements" element={<Requirements />} />

      {/* æ–°å¢ï¼šè‡ªåŠ¨åŒ–å·¥ä½œæµè·¯ç”± */}
      <Route
        path="/automation/workflow/create"
        element={<AutomationWorkflowCreate />}
      />
    </Routes>
  );
}
```

#### âœ… ä»»åŠ¡ 2: æ·»åŠ èœå•å…¥å£

```tsx
// frontend/src/components/Layout.tsx

const menuItems = [
  // ç°æœ‰èœå•é¡¹
  { key: 'dashboard', label: 'é¦–é¡µ', path: '/' },
  { key: 'requirements', label: 'éœ€æ±‚ç®¡ç†', path: '/requirements' },

  // æ–°å¢ï¼šè‡ªåŠ¨åŒ–å·¥ä½œæµ
  {
    key: 'automation',
    label: 'è‡ªåŠ¨åŒ–ç”¨ä¾‹',
    icon: <RocketOutlined />,
    path: '/automation/workflow/create'
  }
];
```

#### âœ… ä»»åŠ¡ 3: è¿è¡Œæµ‹è¯•

```bash
# 1. å¯åŠ¨åç«¯
cd backend
python -m scripts.main

# 2. è¿è¡Œæµ‹è¯•è„šæœ¬
python -m scripts.test_langgraph_workflow

# 3. æ£€æŸ¥æ—¥å¿—
# ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œæ­£å¸¸
```

### 10.2 éœ€è¦åè°ƒ

#### ğŸ¤ ä»»åŠ¡ 4: ä¸è‡ªåŠ¨åŒ–å¹³å°æ–¹ç¡®è®¤

**éœ€æ±‚**: æ–°å¢å­—æ®µå…ƒæ•°æ® API

**API è§„æ ¼**:
```
GET /ai/case/queryFieldMetadata?sceneId={sceneId}

å“åº”æ ¼å¼:
{
  "success": true,
  "data": {
    "sceneId": "SCENE_456",
    "fields": [
      {
        "row": "CP_accidentType_1",
        "rowName": "ç†èµ”_å‡ºé™©äººç±»å‹_1",
        "type": "select",
        "required": true,
        "enums": [
          {"value": "1", "label": "è¢«ä¿äºº"},
          {"value": "2", "label": "å—ç›Šäºº"}
        ],
        "enumDependencies": [
          {
            "enumValue": "1",
            "showFields": ["CP_accidentReason_1"],
            "requiredFields": ["CP_accidentReason_1"]
          }
        ]
      }
    ]
  }
}
```

**ä¼˜å…ˆçº§**: ä¸­ï¼ˆåœ¨æ­¤ä¹‹å‰ï¼Œæ ¡éªŒåŠŸèƒ½ä¼šè¢«è·³è¿‡ï¼‰

### 10.3 ä¼˜åŒ–å»ºè®®

#### ğŸ“ˆ é˜¶æ®µä¸€ï¼šçŸ­æœŸä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰

1. **æ·»åŠ å·¥ä½œæµå†å²è®°å½•**
   - æŸ¥è¯¢ç”¨æˆ·çš„å†å²å·¥ä½œæµ
   - æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´ã€çŠ¶æ€ã€ç»“æœ

2. **ä¼˜åŒ–å‰ç«¯äº¤äº’**
   - æ·»åŠ åŠ è½½è¿›åº¦æ¡
   - ä¼˜åŒ–å®¡æ ¸ç•Œé¢çš„å“åº”å¼å¸ƒå±€
   - æ·»åŠ å¿«æ·é”®æ”¯æŒ

3. **å®Œå–„é”™è¯¯å¤„ç†**
   - æ›´å‹å¥½çš„é”™è¯¯æç¤º
   - æ·»åŠ é”™è¯¯æ¢å¤å»ºè®®

#### ğŸ“ˆ é˜¶æ®µäºŒï¼šä¸­æœŸä¼˜åŒ–ï¼ˆ1-2 æœˆï¼‰

4. **æ‰¹é‡åˆ›å»ºç”¨ä¾‹**
   - æ”¯æŒä¸€æ¬¡åˆ›å»ºå¤šä¸ªåœºæ™¯çš„ç”¨ä¾‹
   - å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå·¥ä½œæµ

5. **å·¥ä½œæµç›‘æ§**
   - å®æ—¶ç›‘æ§å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€
   - æ·»åŠ æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡

6. **æ•°æ®æ ¡éªŒè§„åˆ™é…ç½®**
   - å¯è§†åŒ–é…ç½®æ ¡éªŒè§„åˆ™
   - æ”¯æŒè‡ªå®šä¹‰æ ¡éªŒé€»è¾‘

#### ğŸ“ˆ é˜¶æ®µä¸‰ï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ3-6 æœˆï¼‰

7. **AI èƒ½åŠ›å¢å¼º**
   - ä½¿ç”¨æ›´å¼ºå¤§çš„æ¨¡å‹
   - ä¼˜åŒ– Prompt å·¥ç¨‹
   - æ·»åŠ å°‘æ ·æœ¬å­¦ä¹ 

8. **å·¥ä½œæµç¼–æ’å™¨**
   - å¯è§†åŒ–ç¼–è¾‘å·¥ä½œæµ
   - æ”¯æŒè‡ªå®šä¹‰èŠ‚ç‚¹
   - å·¥ä½œæµç‰ˆæœ¬ç®¡ç†

9. **é›†æˆæµ‹è¯•å¹³å°**
   - è‡ªåŠ¨æ‰§è¡Œç”Ÿæˆçš„ç”¨ä¾‹
   - æ”¶é›†æ‰§è¡Œç»“æœ
   - åé¦ˆä¼˜åŒ– AI ç”Ÿæˆ

---

## é™„å½•

### é™„å½• A: æ•…éšœæ’æŸ¥

#### é—®é¢˜ 1: å·¥ä½œæµå¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: API è¿”å› 500 é”™è¯¯

**å¯èƒ½åŸå› **:
- è‡ªåŠ¨åŒ–å¹³å° API ä¸å¯ç”¨
- åœºæ™¯ ID ä¸å­˜åœ¨
- æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥è‡ªåŠ¨åŒ–å¹³å° API åœ°å€ï¼š
   ```bash
   curl http://localhost:8087/ai/case/queryBySceneId/SCENE_456
   ```

2. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼š
   ```bash
   docker-compose ps
   ```

3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š
   ```bash
   tail -f backend/logs/app.log
   ```

#### é—®é¢˜ 2: AI ç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**: å·¥ä½œæµå¡åœ¨ `generate_data` èŠ‚ç‚¹

**å¯èƒ½åŸå› **:
- AI æœåŠ¡æœªé…ç½®
- API Key æ— æ•ˆ
- ç½‘ç»œè¶…æ—¶

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ AI æœåŠ¡é…ç½®ï¼š
   - è®¿é—® `/model-configs` é¡µé¢
   - ç¡®è®¤æ¨¡å‹é…ç½®å­˜åœ¨ä¸”æœ‰æ•ˆ

2. éªŒè¯ API Keyï¼š
   ```python
   from langchain_openai import ChatOpenAI
   llm = ChatOpenAI(api_key="your_key")
   llm.invoke("test")
   ```

3. æ£€æŸ¥ç½‘ç»œï¼š
   ```bash
   curl -X POST https://api.openai.com/v1/chat/completions \
     -H "Authorization: Bearer YOUR_KEY" \
     -d '{"model":"gpt-3.5-turbo","messages":[{"role":"user","content":"test"}]}'
   ```

#### é—®é¢˜ 3: äººå·¥å®¡æ ¸ç•Œé¢ä¸æ˜¾ç¤º

**ç—‡çŠ¶**: å·¥ä½œæµçŠ¶æ€æ˜¾ç¤º `reviewing`ï¼Œä½†å‰ç«¯æ— ååº”

**å¯èƒ½åŸå› **:
- å‰ç«¯çŠ¶æ€æœªåŒæ­¥
- API è¿”å›æ•°æ®æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•**:
1. åˆ·æ–°é¡µé¢é‡è¯•

2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼š
   ```
   F12 â†’ Console â†’ æŸ¥çœ‹é”™è¯¯
   ```

3. æ‰‹åŠ¨æŸ¥è¯¢çŠ¶æ€ï¼š
   ```bash
   curl http://localhost:8000/api/v1/automation/workflow/{thread_id}/state
   ```

#### é—®é¢˜ 4: æ£€æŸ¥ç‚¹æ•°æ®åº“æŸå

**ç—‡çŠ¶**: æ— æ³•æ¢å¤å·¥ä½œæµçŠ¶æ€

**è§£å†³æ–¹æ³•**:
```bash
# 1. å¤‡ä»½æ•°æ®åº“
cp backend/data/checkpoints/automation_workflow.db backup.db

# 2. æ£€æŸ¥æ•°æ®åº“
sqlite3 backend/data/checkpoints/automation_workflow.db
> .tables
> SELECT * FROM checkpoints LIMIT 5;

# 3. å¦‚æœæŸåï¼Œåˆ é™¤é‡å»º
rm backend/data/checkpoints/automation_workflow.db
# å·¥ä½œæµä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ£€æŸ¥ç‚¹æ•°æ®åº“
```

### é™„å½• B: é…ç½®å‚è€ƒ

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env æ–‡ä»¶ç¤ºä¾‹

# AI æœåŠ¡é…ç½®
OPENAI_API_KEY=sk-...
OPENAI_API_BASE=https://api.openai.com/v1
MODEL_NAME=gpt-4

# è‡ªåŠ¨åŒ–å¹³å°é…ç½®
AUTOMATION_PLATFORM_API_BASE=http://localhost:8087

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql+psycopg://testcase:testcase123@localhost:5432/test_case_db

# Milvus é…ç½®
MILVUS_HOST=localhost
MILVUS_PORT=19530

# åµŒå…¥æœåŠ¡é…ç½®
EMBEDDING_API_KEY=sk-...
EMBEDDING_API_BASE=https://api.siliconflow.cn/v1
EMBEDDING_MODEL=BAAI/bge-large-zh-v1.5
```

#### å‰ç«¯é…ç½®

```typescript
// frontend/src/utils/request.ts

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000/api/v1';

export const request = {
  get: (url: string) => fetch(`${API_BASE_URL}${url}`),
  post: (url: string, data: any) => fetch(`${API_BASE_URL}${url}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
};
```

### é™„å½• C: å‚è€ƒèµ„æº

#### å®˜æ–¹æ–‡æ¡£

- **LangGraph å®˜æ–¹æ–‡æ¡£**: https://langchain-ai.github.io/langgraph/
- **LangChain å®˜æ–¹æ–‡æ¡£**: https://python.langchain.com
- **FastAPI å®˜æ–¹æ–‡æ¡£**: https://fastapi.tiangolo.com
- **Ant Design å®˜æ–¹æ–‡æ¡£**: https://ant.design

#### é¡¹ç›®æ–‡æ¡£

- **å®Œæ•´æ–¹æ¡ˆè®¾è®¡**: `doc/TEST_DATA_GENERATION.md`
- **ä½¿ç”¨æŒ‡å—**: `doc/LANGGRAPH_WORKFLOW_GUIDE.md`
- **API æ–‡æ¡£**: å¯åŠ¨åç«¯åè®¿é—® `http://localhost:8000/docs`

#### ä»£ç ç¤ºä¾‹

- **æµ‹è¯•è„šæœ¬**: `backend/scripts/test_langgraph_workflow.py`
- **æ ¸å¿ƒå®ç°**: `backend/app/services/automation_workflow_service.py`
- **å‰ç«¯ç»„ä»¶**: `frontend/src/components/HumanReviewModal.tsx`

---

## æ€»ç»“

æœ¬æ¬¡ **LangGraph è‡ªåŠ¨åŒ–ç”¨ä¾‹å·¥ä½œæµæ”¹é€ **å·²å…¨éƒ¨å®Œæˆï¼Œå®ç°äº†ï¼š

âœ… **åŸºäº LangGraph çš„çŠ¶æ€æœºå·¥ä½œæµ**ï¼ˆ9ä¸ªèŠ‚ç‚¹ï¼Œæ”¯æŒæš‚åœã€æ¢å¤ã€é‡è¯•ï¼‰
âœ… **äººå·¥å®¡æ ¸ï¼ˆHuman-in-the-Loopï¼‰**ï¼ˆè‡ªåŠ¨æš‚åœï¼Œå‰ç«¯å®æ—¶å®¡æ ¸ç•Œé¢ï¼‰
âœ… **æ™ºèƒ½æ•°æ®æ ¡éªŒ**ï¼ˆæšä¸¾å€¼ã€è”åŠ¨è§„åˆ™ã€å¿…å¡«å­—æ®µä¸‰å±‚æ ¡éªŒï¼‰
âœ… **çŠ¶æ€æŒä¹…åŒ–**ï¼ˆSQLite æ£€æŸ¥ç‚¹ï¼Œæ–­ç”µå¯æ¢å¤ï¼‰
âœ… **å®Œæ•´çš„ API å’Œå‰ç«¯ç»„ä»¶**ï¼ˆ4ä¸ª API ç«¯ç‚¹ï¼Œ2ä¸ªå‰ç«¯ç»„ä»¶ï¼‰
âœ… **æµ‹è¯•è„šæœ¬å’Œæ–‡æ¡£**ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå®Œæ•´ä½¿ç”¨æŒ‡å—ï¼‰

**æ€»ä»£ç é‡**: çº¦ **2,855 è¡Œ**æ ¸å¿ƒä»£ç 
**å¼€å‘æ—¶é—´**: 1 ä¸ªå®Œæ•´ä¼šè¯
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. æ›´æ–°å‰ç«¯è·¯ç”±å’Œèœå•
2. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½
3. ä¸è‡ªåŠ¨åŒ–å¹³å°æ–¹ç¡®è®¤å­—æ®µå…ƒæ•°æ® API
4. å¼€å§‹ä½¿ç”¨å¹¶æ”¶é›†åé¦ˆ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-04
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ
