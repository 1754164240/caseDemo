# æµ‹è¯•ç”¨ä¾‹å¯¼å‡ºExcelåŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†æµ‹è¯•ç”¨ä¾‹æŒ‰ç…§éœ€æ±‚å’Œæµ‹è¯•ç‚¹å¯¼å‡ºExcelæ–‡æ¡£çš„åŠŸèƒ½ï¼Œæ”¯æŒç­›é€‰å¯¼å‡ºå’Œå…¨é‡å¯¼å‡ºã€‚

---

## å®ç°å†…å®¹

### 1. **åç«¯API** âœ…

#### æ–°å¢å¯¼å‡ºç«¯ç‚¹

**æ–‡ä»¶**: `backend/app/api/v1/endpoints/test_cases.py`

**ç«¯ç‚¹**: `GET /api/v1/test-cases/export/excel`

**å‚æ•°**:
- `requirement_id` (å¯é€‰): æŒ‰éœ€æ±‚ç­›é€‰
- `test_point_id` (å¯é€‰): æŒ‰æµ‹è¯•ç‚¹ç­›é€‰

**åŠŸèƒ½**:
- æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æµ‹è¯•ç”¨ä¾‹
- ç”ŸæˆExcelå·¥ä½œç°¿
- è®¾ç½®è¡¨å¤´æ ·å¼ï¼ˆè“è‰²èƒŒæ™¯ã€ç™½è‰²å­—ä½“ã€å±…ä¸­å¯¹é½ï¼‰
- å¡«å……æ•°æ®ï¼ˆéœ€æ±‚åç§°ã€æµ‹è¯•ç‚¹ã€æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…ï¼‰
- æ ¼å¼åŒ–æµ‹è¯•æ­¥éª¤ï¼ˆå¸¦åºå·å’Œé¢„æœŸç»“æœï¼‰
- è¿”å›æ–‡ä»¶æµä¾›ä¸‹è½½

**Excelè¡¨å¤´**:
```
éœ€æ±‚åç§° | æµ‹è¯•ç‚¹ç¼–å· | æµ‹è¯•ç‚¹åç§° | æµ‹è¯•ç”¨ä¾‹ç¼–å· | æµ‹è¯•ç”¨ä¾‹æ ‡é¢˜ | 
æè¿° | å‰ç½®æ¡ä»¶ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | æµ‹è¯•ç±»å‹ | 
å®¡æ‰¹çŠ¶æ€ | å®¡æ‰¹æ„è§ | åˆ›å»ºæ—¶é—´
```

**æ ·å¼è®¾ç½®**:
- è¡¨å¤´: è“è‰²èƒŒæ™¯ (#4472C4)ã€ç™½è‰²å­—ä½“ã€åŠ ç²—ã€å±…ä¸­
- æ•°æ®å•å…ƒæ ¼: å¾®è½¯é›…é»‘å­—ä½“ã€å·¦å¯¹é½ã€è‡ªåŠ¨æ¢è¡Œ
- è¾¹æ¡†: æ‰€æœ‰å•å…ƒæ ¼éƒ½æœ‰ç»†è¾¹æ¡†
- åˆ—å®½: æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´
- è¡Œé«˜: è¡¨å¤´30ã€æ•°æ®è¡Œ60

---

### 2. **å‰ç«¯APIæœåŠ¡** âœ…

**æ–‡ä»¶**: `frontend/src/services/api.ts`

**æ–°å¢æ–¹æ³•**:
```typescript
exportExcel: (params?: { requirement_id?: number; test_point_id?: number }) => {
  const queryParams = new URLSearchParams()
  if (params?.requirement_id) queryParams.append('requirement_id', params.requirement_id.toString())
  if (params?.test_point_id) queryParams.append('test_point_id', params.test_point_id.toString())
  
  return fetch(`${import.meta.env.VITE_API_BASE_URL || ''}/api/v1/test-cases/export/excel?${queryParams}`, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`,
    },
  })
}
```

---

### 3. **å‰ç«¯UI** âœ…

**æ–‡ä»¶**: `frontend/src/pages/TestCases.tsx`

#### æ–°å¢å¯¼å‡ºæŒ‰é’®

ä½ç½®: æµ‹è¯•ç”¨ä¾‹Tabçš„ç­›é€‰æ å³ä¾§

```tsx
<Button
  type="primary"
  icon={<DownloadOutlined />}
  onClick={handleExportTestCases}
  disabled={testCases.length === 0}
>
  å¯¼å‡ºExcel
</Button>
```

#### å¯¼å‡ºå‡½æ•°

```typescript
const handleExportTestCases = async () => {
  try {
    const params: { requirement_id?: number; test_point_id?: number } = {}
    
    // æ ¹æ®å½“å‰ç­›é€‰æ¡ä»¶å¯¼å‡º
    if (selectedRequirementFilter) {
      params.requirement_id = selectedRequirementFilter
    }
    if (selectedTestPointFilter) {
      params.test_point_id = selectedTestPointFilter
    }

    message.loading({ content: 'æ­£åœ¨å¯¼å‡º...', key: 'export' })
    
    const response = await testCasesAPI.exportExcel(params)
    
    // è·å–æ–‡ä»¶åå¹¶ä¸‹è½½
    const blob = await response.blob()
    const url = window.URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = filename
    document.body.appendChild(a)
    a.click()
    window.URL.revokeObjectURL(url)
    document.body.removeChild(a)

    message.success({ content: 'å¯¼å‡ºæˆåŠŸ', key: 'export' })
  } catch (error: any) {
    message.error({ content: error.message || 'å¯¼å‡ºå¤±è´¥', key: 'export' })
  }
}
```

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¯¼å‡ºå…¨éƒ¨æµ‹è¯•ç”¨ä¾‹

1. è®¿é—® "ç”¨ä¾‹ç®¡ç†" é¡µé¢
2. åˆ‡æ¢åˆ° "æµ‹è¯•ç”¨ä¾‹" Tab
3. ä¸é€‰æ‹©ä»»ä½•ç­›é€‰æ¡ä»¶
4. ç‚¹å‡» "å¯¼å‡ºExcel" æŒ‰é’®
5. âœ… å¯¼å‡ºæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹

**æ–‡ä»¶å**: `æµ‹è¯•ç”¨ä¾‹_20250112_143025.xlsx`

---

### åœºæ™¯ 2: æŒ‰éœ€æ±‚å¯¼å‡º

1. åœ¨ "ç­›é€‰éœ€æ±‚" ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©éœ€æ±‚
2. ç‚¹å‡» "å¯¼å‡ºExcel" æŒ‰é’®
3. âœ… åªå¯¼å‡ºè¯¥éœ€æ±‚ä¸‹çš„æµ‹è¯•ç”¨ä¾‹

**æ–‡ä»¶å**: `æµ‹è¯•ç”¨ä¾‹_éœ€æ±‚åç§°_20250112_143025.xlsx`

---

### åœºæ™¯ 3: æŒ‰æµ‹è¯•ç‚¹å¯¼å‡º

1. åœ¨ "ç­›é€‰æµ‹è¯•ç‚¹" ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©æµ‹è¯•ç‚¹
2. ç‚¹å‡» "å¯¼å‡ºExcel" æŒ‰é’®
3. âœ… åªå¯¼å‡ºè¯¥æµ‹è¯•ç‚¹ä¸‹çš„æµ‹è¯•ç”¨ä¾‹

**æ–‡ä»¶å**: `æµ‹è¯•ç”¨ä¾‹_æµ‹è¯•ç‚¹åç§°_20250112_143025.xlsx`

---

## Excelæ–‡ä»¶ç¤ºä¾‹

### è¡¨å¤´æ ·å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éœ€æ±‚åç§° â”‚ æµ‹è¯•ç‚¹ç¼–å· â”‚ æµ‹è¯•ç‚¹åç§° â”‚ æµ‹è¯•ç”¨ä¾‹ç¼–å· â”‚ æµ‹è¯•ç”¨ä¾‹æ ‡é¢˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

### æ•°æ®ç¤ºä¾‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿é™©äº§å“è§„æ ¼è¯´æ˜ â”‚ TP-001 â”‚ æŠ•ä¿äººä¿¡æ¯éªŒè¯ â”‚ TP-001-1 â”‚ éªŒè¯æŠ•ä¿äººå§“å â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æè¿°: éªŒè¯æŠ•ä¿äººå§“åçš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§                                â”‚
â”‚ å‰ç½®æ¡ä»¶: ç”¨æˆ·å·²ç™»å½•ç³»ç»Ÿ                                          â”‚
â”‚ æµ‹è¯•æ­¥éª¤:                                                         â”‚
â”‚   1. è¾“å…¥æŠ•ä¿äººå§“å                                               â”‚
â”‚      é¢„æœŸ: ç³»ç»Ÿæ¥å—è¾“å…¥                                           â”‚
â”‚   2. ç‚¹å‡»æäº¤æŒ‰é’®                                                 â”‚
â”‚      é¢„æœŸ: ç³»ç»ŸéªŒè¯é€šè¿‡                                           â”‚
â”‚ é¢„æœŸç»“æœ: æŠ•ä¿äººä¿¡æ¯ä¿å­˜æˆåŠŸ                                      â”‚
â”‚ ä¼˜å…ˆçº§: é«˜                                                        â”‚
â”‚ æµ‹è¯•ç±»å‹: functional                                              â”‚
â”‚ å®¡æ‰¹çŠ¶æ€: å·²é€šè¿‡                                                  â”‚
â”‚ å®¡æ‰¹æ„è§: æµ‹è¯•ç”¨ä¾‹è®¾è®¡åˆç†                                        â”‚
â”‚ åˆ›å»ºæ—¶é—´: 2025-01-12 14:30:25                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æ˜ å°„

### å®¡æ‰¹çŠ¶æ€
- `pending` â†’ å¾…å®¡æ‰¹
- `approved` â†’ å·²é€šè¿‡
- `rejected` â†’ å·²æ‹’ç»

### ä¼˜å…ˆçº§
- `high` â†’ é«˜
- `medium` â†’ ä¸­
- `low` â†’ ä½

### æµ‹è¯•æ­¥éª¤æ ¼å¼åŒ–
```
1. æ“ä½œæ­¥éª¤1
   é¢„æœŸ: é¢„æœŸç»“æœ1
2. æ“ä½œæ­¥éª¤2
   é¢„æœŸ: é¢„æœŸç»“æœ2
```

---

## æŠ€æœ¯å®ç°

### åç«¯ä¾èµ–
- `openpyxl==3.1.2` - Excelæ–‡ä»¶æ“ä½œåº“
- `FastAPI StreamingResponse` - æ–‡ä»¶æµå“åº”

### å‰ç«¯æŠ€æœ¯
- `fetch API` - æ–‡ä»¶ä¸‹è½½
- `Blob` - äºŒè¿›åˆ¶æ•°æ®å¤„ç†
- `URL.createObjectURL` - åˆ›å»ºä¸‹è½½é“¾æ¥

---

## æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡
```bash
# åç«¯
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# å‰ç«¯
cd frontend
npm run dev
```

### 2. æµ‹è¯•å¯¼å‡º

1. **ç™»å½•ç³»ç»Ÿ**
   - è®¿é—® http://localhost:5173
   - ä½¿ç”¨ admin / admin123 ç™»å½•

2. **å‡†å¤‡æµ‹è¯•æ•°æ®**
   - ä¸Šä¼ éœ€æ±‚æ–‡æ¡£
   - ç”Ÿæˆæµ‹è¯•ç‚¹
   - ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹

3. **æµ‹è¯•å…¨é‡å¯¼å‡º**
   - è®¿é—® "ç”¨ä¾‹ç®¡ç†" â†’ "æµ‹è¯•ç”¨ä¾‹" Tab
   - ç‚¹å‡» "å¯¼å‡ºExcel" æŒ‰é’®
   - âœ… é¢„æœŸ: ä¸‹è½½åŒ…å«æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„Excelæ–‡ä»¶

4. **æµ‹è¯•ç­›é€‰å¯¼å‡º**
   - é€‰æ‹©éœ€æ±‚æˆ–æµ‹è¯•ç‚¹
   - ç‚¹å‡» "å¯¼å‡ºExcel" æŒ‰é’®
   - âœ… é¢„æœŸ: åªå¯¼å‡ºç­›é€‰åçš„æµ‹è¯•ç”¨ä¾‹

5. **éªŒè¯Excelå†…å®¹**
   - æ‰“å¼€ä¸‹è½½çš„Excelæ–‡ä»¶
   - âœ… æ£€æŸ¥è¡¨å¤´æ ·å¼
   - âœ… æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
   - âœ… æ£€æŸ¥æµ‹è¯•æ­¥éª¤æ ¼å¼
   - âœ… æ£€æŸ¥ä¸­æ–‡æ˜¾ç¤ºæ­£å¸¸

---

## ç›¸å…³æ–‡ä»¶

- âœ… `backend/app/api/v1/endpoints/test_cases.py` - å¯¼å‡ºAPIç«¯ç‚¹
- âœ… `frontend/src/services/api.ts` - å‰ç«¯APIæœåŠ¡
- âœ… `frontend/src/pages/TestCases.tsx` - æµ‹è¯•ç”¨ä¾‹é¡µé¢UI

---

## ä¼˜åŒ–å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–
- å¤§æ•°æ®é‡æ—¶åˆ†æ‰¹å¯¼å‡º
- æ·»åŠ å¯¼å‡ºè¿›åº¦æç¤º
- æ”¯æŒåå°å¼‚æ­¥å¯¼å‡º

### 2. åŠŸèƒ½å¢å¼º
- æ”¯æŒè‡ªå®šä¹‰å¯¼å‡ºå­—æ®µ
- æ”¯æŒå¯¼å‡ºæ¨¡æ¿ä¸‹è½½
- æ”¯æŒæ‰¹é‡å¯¼å…¥æµ‹è¯•ç”¨ä¾‹

### 3. æ ·å¼ä¼˜åŒ–
- æ”¯æŒè‡ªå®šä¹‰Excelæ ·å¼
- æ·»åŠ å…¬å¸Logo
- æ·»åŠ é¡µçœ‰é¡µè„š

---

æ‰€æœ‰åŠŸèƒ½å·²å®ç°! ğŸ‰ ç°åœ¨å¯ä»¥æŒ‰éœ€æ±‚å’Œæµ‹è¯•ç‚¹å¯¼å‡ºæµ‹è¯•ç”¨ä¾‹åˆ°Exceläº†! ğŸŠ

